{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","src/js/config.js","src/js/lib/pubsub.js","src/js/main.js","src/js/models/Card.js","src/js/models/CardManager.js","src/js/prototypes.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","module.exports = {\n  SAVE_CARDS: 'SAVE_CARDS'\n}","\nvar subs = {};\n\n\nfunction pub(name, params) {\n  subs[name].forEach(function(elem) {\n    elem.callback.apply(elem.context, params);\n  });\n}\n\nfunction sub(name, callback, context) {\n  if (subs[name] === undefined) {\n    subs[name] = [];\n  }\n\n  subs[name].push({\n    callback: callback,\n    context: context\n  });\n}\n\n\nmodule.exports = {\n  pub: pub,\n  sub: sub\n};","window.CONFIG = require('./config.js');\n\nlet prototypes = require('./prototypes'),\n  Card = require('./models/Card'),\n  CardManager = require('./models/CardManager');\n\nlet mainContainer,\n  input,\n  editContainer,\n  editInput;\n\n\nlet cardManager = CardManager.getInstance();\n\nObject.assign(window, require('./prototypes'));\n\n\ndocument.addEventListener('DOMContentLoaded', function () {\n  'strict mode';\n\n  mainContainer = $('#mainContainer');\n  input = document.querySelector('#formContainer input');\n  editContainer = document.getElementById('editContainer');\n  editInput = editContainer.getElementsByClassName('textarea')[0];\n\n\n  window.addEventListener('keydown', keyHandler, false);\n  input.addEventListener('keydown', mainInputKeyEvent);\n  editInput.addEventListener('keydown', editInputKeyEvent);\n  /*\n   On double click edit the card\n   */\n  mainContainer.on('dblclick', 'div', doubleClickHandler);\n  /*\n   On click perform the card\n   */\n  mainContainer.on('click', 'div', cardClickEvents);\n  mainContainer.on('click', 'div > div', cardMenuEvents);\n\n\n  cardManager.loadCards();\n  cardManager.renderAllCards();\n  input.focus();\n});\n\n\nfunction mainInputKeyEvent (event) {\n  event.stopPropagation();\n  let card;\n\n  if (event.keyCode === 13) {\n    card = cardManager.addCard(Object.create(Card, {}).init(input.value));\n    card.render();\n    this.value = '';\n    cardManager.saveCards();\n  }\n}\n\nfunction editInputKeyEvent (event) {\n  event.stopPropagation();\n  let card;\n  if (event.keyCode === 13 && event.shiftKey) return;\n  if (event.keyCode === 13) {\n    card = cardManager.cards[editContainer.cardId];\n    card.name = editInput.value;\n    card.derender();\n    card.render();\n    this.value = '';\n    cardManager.saveCards();\n\n    editContainer.style.display = 'none';\n  }\n}\n\nfunction keyHandler (e) {\n  let TABKEY = 9;\n  if (e.keyCode === TABKEY) {\n    if (event.shiftKey) {\n      console.log('MoveToPreviousCard');\n    } else {\n      console.log('MoveToNextCard');\n    }\n    if (e.preventDefault) {\n      e.preventDefault();\n    }\n    return false;\n  }\n}\n\nfunction doubleClickHandler () {\n  let elem = this.querySelector('.cardText'),\n    cardId,\n    card;\n\n  if (this.id === '') {\n    cardId = parseInt(this.parentElement.id.split('_')[1]);\n  } else {\n    cardId = parseInt(this.id.split('_')[1]);\n  }\n\n  card = cardManager.cards[cardId];\n\n  editInput.value = card.name;\n  editContainer.cardId = cardId;\n  editContainer.style.display = 'block';\n  editInput.focus();\n}\n\nfunction cardClickEvents (event) {\n  let elem = this.querySelector('.cardText'),\n    cardId = parseInt(this.id.split('_')[1]),\n    card = cardManager.cards[cardId];\n\n  if (event.ctrlKey) {\n  }\n  if (event.altKey) {\n    this.querySelector('.copy').click();\n  }\n  if (event.shiftKey) {\n\n  }\n}\n\nfunction cardMenuEvents () {\n  let option = $(this).html(),\n    selection,\n    cardId = getParentCardId(this);\n\n  switch (option) {\n    case '+':\n      changeDepth.apply(this, [cardId, 1]);\n      break;\n    case '-':\n      changeDepth.apply(this, [cardId, -1]);\n      break;\n    case 'C':\n      selection = selectText(this.parentElement.getElementsByClassName('cardText')[0]);\n      copySelectionText();\n      selection.empty();\n      break;\n    case 'x':\n      cardManager.removeCard(cardId, -1);\n      break;\n  }\n  cardManager.saveCards();\n}","let pubsub = require('../lib/pubsub');\n\nlet Card = {\n  init: function (name) {\n    this.id = -1;\n    this.name = name;\n    this.depth = 5;\n    this.x = 100;\n    this.y = 100;\n    this.color = '#' + Math.floor(Math.random() * 16777215).toString(16);\n\n    return this;\n  },\n  render: function () {\n    let node = document.createElement('div'),\n      text = document.createElement('div'),\n      that = this;\n\n    text.innerHTML = this.name;\n    text.className = 'cardText';\n\n    node.id = 'todo_' + this.id;\n    node.className = 'card card-1';\n    node.style.position = 'fixed';\n    node.style.left = this.x;\n    node.style.top = this.y;\n    node.style.cursor = '-webkit-grab';\n    node.style.zIndex = this.depth;\n\n    document.getElementById('mainContainer').appendChild(node);\n\n    node.appendChild(createDiv('x', 'control remove'));\n    node.appendChild(createDiv('+', 'control up'));\n    node.appendChild(createDiv('-', 'control down'));\n    node.appendChild(createDiv('C', 'control copy'));\n    node.appendChild(createDiv(this.depth, 'depth'));\n\n    node.appendChild(text);\n\n    $('#todo_' + this.id).draggable({\n      stop: function () {\n        let card = $('#todo_' + that.id);\n        that.x = card.css('left');\n        that.y = card.css('top');\n\n        // cardManager.saveCards();\n        pubsub.pub(window.CONFIG.SAVE_CARDS);\n      },\n    }).html(this.name.replace(/\\r?\\n/g,'<br/>'));;\n\n    return this;\n  },\n  derender: function () {\n    let node = document.getElementById('todo_' + this.id);\n    document.getElementById('mainContainer').removeChild(node);\n\n    return this;\n  },\n};\n\nmodule.exports = Card;","const Card = require('./Card'),\n  pubsub = require('../lib/pubsub');\n\nlet CardManager = {\n  init: function () {\n    this.cards = [];\n\n    return this;\n  },\n  addCard: function (card) {\n    this.cards.push(card);\n    card.id = this.cards.length - 1;\n\n    return card;\n  },\n  removeCard: function (id) {\n    this.cards[id].derender();\n    this.cards[id] = undefined;\n\n    return this;\n  },\n  redrawCard: function (cardId, x, y) {\n    let card = this.cards[cardId];\n    card.x = x;\n    card.y = y;\n\n    card.derender();\n    card.render();\n\n    return this;\n  },\n  saveCards: function () {\n    if (typeof(Storage) !== 'undefined') {\n      localStorage.setItem('cards', JSON.stringify(this.cards));\n    } else {\n      console.log('you don\\'t have local storage :(');\n    }\n\n    return this;\n  },\n  loadCards: function () {\n    let i;\n\n    this.cards = JSON.parse(localStorage.getItem('cards'));\n    if (this.cards === null) this.cards = [];\n\n    this.clearArray();\n\n    return this;\n  },\n  clearArray: function () {\n    let i;\n\n    this.cards = this.cards.filter(function (elem) {\n      return elem !== undefined && elem !== null;\n    });\n    for (i in this.cards) {\n      if (this.cards.hasOwnProperty(i)) {\n        this.cards[i].id = i;\n      }\n    }\n\n    return this;\n  },\n  renderAllCards: function () {\n    this.cards.forEach(function (card) {\n      // card.__proto__ = Card.prototype;\n      Object.setPrototypeOf(card, Card);\n      card.render();\n    });\n\n    return this;\n  },\n  getInstance: function () {\n    if (CardManager.instance === undefined) {\n      CardManager.instance = Object.create(CardManager, {});\n      pubsub.sub(window.CONFIG.SAVE_CARDS, CardManager.instance.saveCards, CardManager.instance);\n    }\n\n    return CardManager.instance;\n\n  },\n};\n\nmodule.exports = CardManager;","let cardManager = require('./models/CardManager').getInstance();\n\nfunction createDiv(text, className) {\n  let div = document.createElement('div');\n  div.innerHTML = text;\n  div.style.float = \"right\";\n  div.style.cursor = \"pointer\";\n  div.style.width = \"16px\";\n  div.style.textAlign = \"center\";\n\n  if (className !== undefined) {\n    div.className = className;\n  }\n\n  return div;\n}\n\nfunction copySelectionText() {\n  let copysuccess; // let to check whether execCommand successfully executed\n  try {\n    copysuccess = document.execCommand(\"copy\"); // run command to copy selected text to clipboard\n  } catch (e) {\n    copysuccess = false\n  }\n  return copysuccess\n}\n\nfunction selectText(element) {\n  let doc = document\n    , text = element\n    , range, selection\n    ;\n  if (doc.body.createTextRange) {\n    range = document.body.createTextRange();\n    range.moveToElementText(text);\n    range.select();\n  } else if (window.getSelection) {\n    selection = window.getSelection();\n    range = document.createRange();\n    range.selectNodeContents(text);\n    selection.removeAllRanges();\n    selection.addRange(range);\n    return selection;\n  }\n}\n\nfunction getParentCardId(context) {\n  if (context.parentElement === null) return;\n  return parseInt(context.parentElement.id.split(\"_\")[1]);\n}\n\nfunction changeDepth(cardId, increment) {\n  let depth = parseInt(this.parentElement.style.zIndex) + increment;\n\n  this.parentElement.style.zIndex = depth;\n  cardManager.cards[cardId].depth = depth;\n  this.parentElement.getElementsByClassName(\"depth\")[0].innerHTML = depth;\n}\n\n// PROTOTYPES\n\n/*\n * Returns the size of an array\n */\nArray.prototype.size = function () {\n  return this.filter(function (a) {\n    return a !== undefined;\n  }).length\n};\n\n/*\n * Returns the size of an object\n */\nObject.size = function (obj) {\n  let size = 0, key = \"\";\n\n  for (key in obj) {\n    if (obj.hasOwnProperty(key)) size++;\n  }\n  return size;\n};\n\nmodule.exports = {\n  createDiv: createDiv,\n  copySelectionText: copySelectionText,\n  selectText: selectText,\n  getParentCardId: getParentCardId,\n  changeDepth: changeDepth\n}"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvY29uZmlnLmpzIiwic3JjL2pzL2xpYi9wdWJzdWIuanMiLCJzcmMvanMvbWFpbi5qcyIsInNyYy9qcy9tb2RlbHMvQ2FyZC5qcyIsInNyYy9qcy9tb2RlbHMvQ2FyZE1hbmFnZXIuanMiLCJzcmMvanMvcHJvdG90eXBlcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTs7QUNGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwibW9kdWxlLmV4cG9ydHMgPSB7XG4gIFNBVkVfQ0FSRFM6ICdTQVZFX0NBUkRTJ1xufSIsIlxudmFyIHN1YnMgPSB7fTtcblxuXG5mdW5jdGlvbiBwdWIobmFtZSwgcGFyYW1zKSB7XG4gIHN1YnNbbmFtZV0uZm9yRWFjaChmdW5jdGlvbihlbGVtKSB7XG4gICAgZWxlbS5jYWxsYmFjay5hcHBseShlbGVtLmNvbnRleHQsIHBhcmFtcyk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBzdWIobmFtZSwgY2FsbGJhY2ssIGNvbnRleHQpIHtcbiAgaWYgKHN1YnNbbmFtZV0gPT09IHVuZGVmaW5lZCkge1xuICAgIHN1YnNbbmFtZV0gPSBbXTtcbiAgfVxuXG4gIHN1YnNbbmFtZV0ucHVzaCh7XG4gICAgY2FsbGJhY2s6IGNhbGxiYWNrLFxuICAgIGNvbnRleHQ6IGNvbnRleHRcbiAgfSk7XG59XG5cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIHB1YjogcHViLFxuICBzdWI6IHN1YlxufTsiLCJ3aW5kb3cuQ09ORklHID0gcmVxdWlyZSgnLi9jb25maWcuanMnKTtcblxubGV0IHByb3RvdHlwZXMgPSByZXF1aXJlKCcuL3Byb3RvdHlwZXMnKSxcbiAgQ2FyZCA9IHJlcXVpcmUoJy4vbW9kZWxzL0NhcmQnKSxcbiAgQ2FyZE1hbmFnZXIgPSByZXF1aXJlKCcuL21vZGVscy9DYXJkTWFuYWdlcicpO1xuXG5sZXQgbWFpbkNvbnRhaW5lcixcbiAgaW5wdXQsXG4gIGVkaXRDb250YWluZXIsXG4gIGVkaXRJbnB1dDtcblxuXG5sZXQgY2FyZE1hbmFnZXIgPSBDYXJkTWFuYWdlci5nZXRJbnN0YW5jZSgpO1xuXG5PYmplY3QuYXNzaWduKHdpbmRvdywgcmVxdWlyZSgnLi9wcm90b3R5cGVzJykpO1xuXG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbiAoKSB7XG4gICdzdHJpY3QgbW9kZSc7XG5cbiAgbWFpbkNvbnRhaW5lciA9ICQoJyNtYWluQ29udGFpbmVyJyk7XG4gIGlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2Zvcm1Db250YWluZXIgaW5wdXQnKTtcbiAgZWRpdENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0Q29udGFpbmVyJyk7XG4gIGVkaXRJbnB1dCA9IGVkaXRDb250YWluZXIuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgndGV4dGFyZWEnKVswXTtcblxuXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywga2V5SGFuZGxlciwgZmFsc2UpO1xuICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgbWFpbklucHV0S2V5RXZlbnQpO1xuICBlZGl0SW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGVkaXRJbnB1dEtleUV2ZW50KTtcbiAgLypcbiAgIE9uIGRvdWJsZSBjbGljayBlZGl0IHRoZSBjYXJkXG4gICAqL1xuICBtYWluQ29udGFpbmVyLm9uKCdkYmxjbGljaycsICdkaXYnLCBkb3VibGVDbGlja0hhbmRsZXIpO1xuICAvKlxuICAgT24gY2xpY2sgcGVyZm9ybSB0aGUgY2FyZFxuICAgKi9cbiAgbWFpbkNvbnRhaW5lci5vbignY2xpY2snLCAnZGl2JywgY2FyZENsaWNrRXZlbnRzKTtcbiAgbWFpbkNvbnRhaW5lci5vbignY2xpY2snLCAnZGl2ID4gZGl2JywgY2FyZE1lbnVFdmVudHMpO1xuXG5cbiAgY2FyZE1hbmFnZXIubG9hZENhcmRzKCk7XG4gIGNhcmRNYW5hZ2VyLnJlbmRlckFsbENhcmRzKCk7XG4gIGlucHV0LmZvY3VzKCk7XG59KTtcblxuXG5mdW5jdGlvbiBtYWluSW5wdXRLZXlFdmVudCAoZXZlbnQpIHtcbiAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gIGxldCBjYXJkO1xuXG4gIGlmIChldmVudC5rZXlDb2RlID09PSAxMykge1xuICAgIGNhcmQgPSBjYXJkTWFuYWdlci5hZGRDYXJkKE9iamVjdC5jcmVhdGUoQ2FyZCwge30pLmluaXQoaW5wdXQudmFsdWUpKTtcbiAgICBjYXJkLnJlbmRlcigpO1xuICAgIHRoaXMudmFsdWUgPSAnJztcbiAgICBjYXJkTWFuYWdlci5zYXZlQ2FyZHMoKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBlZGl0SW5wdXRLZXlFdmVudCAoZXZlbnQpIHtcbiAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gIGxldCBjYXJkO1xuICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMgJiYgZXZlbnQuc2hpZnRLZXkpIHJldHVybjtcbiAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzKSB7XG4gICAgY2FyZCA9IGNhcmRNYW5hZ2VyLmNhcmRzW2VkaXRDb250YWluZXIuY2FyZElkXTtcbiAgICBjYXJkLm5hbWUgPSBlZGl0SW5wdXQudmFsdWU7XG4gICAgY2FyZC5kZXJlbmRlcigpO1xuICAgIGNhcmQucmVuZGVyKCk7XG4gICAgdGhpcy52YWx1ZSA9ICcnO1xuICAgIGNhcmRNYW5hZ2VyLnNhdmVDYXJkcygpO1xuXG4gICAgZWRpdENvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICB9XG59XG5cbmZ1bmN0aW9uIGtleUhhbmRsZXIgKGUpIHtcbiAgbGV0IFRBQktFWSA9IDk7XG4gIGlmIChlLmtleUNvZGUgPT09IFRBQktFWSkge1xuICAgIGlmIChldmVudC5zaGlmdEtleSkge1xuICAgICAgY29uc29sZS5sb2coJ01vdmVUb1ByZXZpb3VzQ2FyZCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZygnTW92ZVRvTmV4dENhcmQnKTtcbiAgICB9XG4gICAgaWYgKGUucHJldmVudERlZmF1bHQpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbmZ1bmN0aW9uIGRvdWJsZUNsaWNrSGFuZGxlciAoKSB7XG4gIGxldCBlbGVtID0gdGhpcy5xdWVyeVNlbGVjdG9yKCcuY2FyZFRleHQnKSxcbiAgICBjYXJkSWQsXG4gICAgY2FyZDtcblxuICBpZiAodGhpcy5pZCA9PT0gJycpIHtcbiAgICBjYXJkSWQgPSBwYXJzZUludCh0aGlzLnBhcmVudEVsZW1lbnQuaWQuc3BsaXQoJ18nKVsxXSk7XG4gIH0gZWxzZSB7XG4gICAgY2FyZElkID0gcGFyc2VJbnQodGhpcy5pZC5zcGxpdCgnXycpWzFdKTtcbiAgfVxuXG4gIGNhcmQgPSBjYXJkTWFuYWdlci5jYXJkc1tjYXJkSWRdO1xuXG4gIGVkaXRJbnB1dC52YWx1ZSA9IGNhcmQubmFtZTtcbiAgZWRpdENvbnRhaW5lci5jYXJkSWQgPSBjYXJkSWQ7XG4gIGVkaXRDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gIGVkaXRJbnB1dC5mb2N1cygpO1xufVxuXG5mdW5jdGlvbiBjYXJkQ2xpY2tFdmVudHMgKGV2ZW50KSB7XG4gIGxldCBlbGVtID0gdGhpcy5xdWVyeVNlbGVjdG9yKCcuY2FyZFRleHQnKSxcbiAgICBjYXJkSWQgPSBwYXJzZUludCh0aGlzLmlkLnNwbGl0KCdfJylbMV0pLFxuICAgIGNhcmQgPSBjYXJkTWFuYWdlci5jYXJkc1tjYXJkSWRdO1xuXG4gIGlmIChldmVudC5jdHJsS2V5KSB7XG4gIH1cbiAgaWYgKGV2ZW50LmFsdEtleSkge1xuICAgIHRoaXMucXVlcnlTZWxlY3RvcignLmNvcHknKS5jbGljaygpO1xuICB9XG4gIGlmIChldmVudC5zaGlmdEtleSkge1xuXG4gIH1cbn1cblxuZnVuY3Rpb24gY2FyZE1lbnVFdmVudHMgKCkge1xuICBsZXQgb3B0aW9uID0gJCh0aGlzKS5odG1sKCksXG4gICAgc2VsZWN0aW9uLFxuICAgIGNhcmRJZCA9IGdldFBhcmVudENhcmRJZCh0aGlzKTtcblxuICBzd2l0Y2ggKG9wdGlvbikge1xuICAgIGNhc2UgJysnOlxuICAgICAgY2hhbmdlRGVwdGguYXBwbHkodGhpcywgW2NhcmRJZCwgMV0pO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnLSc6XG4gICAgICBjaGFuZ2VEZXB0aC5hcHBseSh0aGlzLCBbY2FyZElkLCAtMV0pO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnQyc6XG4gICAgICBzZWxlY3Rpb24gPSBzZWxlY3RUZXh0KHRoaXMucGFyZW50RWxlbWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdjYXJkVGV4dCcpWzBdKTtcbiAgICAgIGNvcHlTZWxlY3Rpb25UZXh0KCk7XG4gICAgICBzZWxlY3Rpb24uZW1wdHkoKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3gnOlxuICAgICAgY2FyZE1hbmFnZXIucmVtb3ZlQ2FyZChjYXJkSWQsIC0xKTtcbiAgICAgIGJyZWFrO1xuICB9XG4gIGNhcmRNYW5hZ2VyLnNhdmVDYXJkcygpO1xufSIsImxldCBwdWJzdWIgPSByZXF1aXJlKCcuLi9saWIvcHVic3ViJyk7XG5cbmxldCBDYXJkID0ge1xuICBpbml0OiBmdW5jdGlvbiAobmFtZSkge1xuICAgIHRoaXMuaWQgPSAtMTtcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIHRoaXMuZGVwdGggPSA1O1xuICAgIHRoaXMueCA9IDEwMDtcbiAgICB0aGlzLnkgPSAxMDA7XG4gICAgdGhpcy5jb2xvciA9ICcjJyArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDE2Nzc3MjE1KS50b1N0cmluZygxNik7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcbiAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IG5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSxcbiAgICAgIHRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSxcbiAgICAgIHRoYXQgPSB0aGlzO1xuXG4gICAgdGV4dC5pbm5lckhUTUwgPSB0aGlzLm5hbWU7XG4gICAgdGV4dC5jbGFzc05hbWUgPSAnY2FyZFRleHQnO1xuXG4gICAgbm9kZS5pZCA9ICd0b2RvXycgKyB0aGlzLmlkO1xuICAgIG5vZGUuY2xhc3NOYW1lID0gJ2NhcmQgY2FyZC0xJztcbiAgICBub2RlLnN0eWxlLnBvc2l0aW9uID0gJ2ZpeGVkJztcbiAgICBub2RlLnN0eWxlLmxlZnQgPSB0aGlzLng7XG4gICAgbm9kZS5zdHlsZS50b3AgPSB0aGlzLnk7XG4gICAgbm9kZS5zdHlsZS5jdXJzb3IgPSAnLXdlYmtpdC1ncmFiJztcbiAgICBub2RlLnN0eWxlLnpJbmRleCA9IHRoaXMuZGVwdGg7XG5cbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbkNvbnRhaW5lcicpLmFwcGVuZENoaWxkKG5vZGUpO1xuXG4gICAgbm9kZS5hcHBlbmRDaGlsZChjcmVhdGVEaXYoJ3gnLCAnY29udHJvbCByZW1vdmUnKSk7XG4gICAgbm9kZS5hcHBlbmRDaGlsZChjcmVhdGVEaXYoJysnLCAnY29udHJvbCB1cCcpKTtcbiAgICBub2RlLmFwcGVuZENoaWxkKGNyZWF0ZURpdignLScsICdjb250cm9sIGRvd24nKSk7XG4gICAgbm9kZS5hcHBlbmRDaGlsZChjcmVhdGVEaXYoJ0MnLCAnY29udHJvbCBjb3B5JykpO1xuICAgIG5vZGUuYXBwZW5kQ2hpbGQoY3JlYXRlRGl2KHRoaXMuZGVwdGgsICdkZXB0aCcpKTtcblxuICAgIG5vZGUuYXBwZW5kQ2hpbGQodGV4dCk7XG5cbiAgICAkKCcjdG9kb18nICsgdGhpcy5pZCkuZHJhZ2dhYmxlKHtcbiAgICAgIHN0b3A6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbGV0IGNhcmQgPSAkKCcjdG9kb18nICsgdGhhdC5pZCk7XG4gICAgICAgIHRoYXQueCA9IGNhcmQuY3NzKCdsZWZ0Jyk7XG4gICAgICAgIHRoYXQueSA9IGNhcmQuY3NzKCd0b3AnKTtcblxuICAgICAgICAvLyBjYXJkTWFuYWdlci5zYXZlQ2FyZHMoKTtcbiAgICAgICAgcHVic3ViLnB1Yih3aW5kb3cuQ09ORklHLlNBVkVfQ0FSRFMpO1xuICAgICAgfSxcbiAgICB9KS5odG1sKHRoaXMubmFtZS5yZXBsYWNlKC9cXHI/XFxuL2csJzxici8+JykpOztcblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICBkZXJlbmRlcjogZnVuY3Rpb24gKCkge1xuICAgIGxldCBub2RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZG9fJyArIHRoaXMuaWQpO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluQ29udGFpbmVyJykucmVtb3ZlQ2hpbGQobm9kZSk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQ2FyZDsiLCJjb25zdCBDYXJkID0gcmVxdWlyZSgnLi9DYXJkJyksXG4gIHB1YnN1YiA9IHJlcXVpcmUoJy4uL2xpYi9wdWJzdWInKTtcblxubGV0IENhcmRNYW5hZ2VyID0ge1xuICBpbml0OiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5jYXJkcyA9IFtdO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIGFkZENhcmQ6IGZ1bmN0aW9uIChjYXJkKSB7XG4gICAgdGhpcy5jYXJkcy5wdXNoKGNhcmQpO1xuICAgIGNhcmQuaWQgPSB0aGlzLmNhcmRzLmxlbmd0aCAtIDE7XG5cbiAgICByZXR1cm4gY2FyZDtcbiAgfSxcbiAgcmVtb3ZlQ2FyZDogZnVuY3Rpb24gKGlkKSB7XG4gICAgdGhpcy5jYXJkc1tpZF0uZGVyZW5kZXIoKTtcbiAgICB0aGlzLmNhcmRzW2lkXSA9IHVuZGVmaW5lZDtcblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICByZWRyYXdDYXJkOiBmdW5jdGlvbiAoY2FyZElkLCB4LCB5KSB7XG4gICAgbGV0IGNhcmQgPSB0aGlzLmNhcmRzW2NhcmRJZF07XG4gICAgY2FyZC54ID0geDtcbiAgICBjYXJkLnkgPSB5O1xuXG4gICAgY2FyZC5kZXJlbmRlcigpO1xuICAgIGNhcmQucmVuZGVyKCk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcbiAgc2F2ZUNhcmRzOiBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHR5cGVvZihTdG9yYWdlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdjYXJkcycsIEpTT04uc3RyaW5naWZ5KHRoaXMuY2FyZHMpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5sb2coJ3lvdSBkb25cXCd0IGhhdmUgbG9jYWwgc3RvcmFnZSA6KCcpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICBsb2FkQ2FyZHM6IGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgaTtcblxuICAgIHRoaXMuY2FyZHMgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjYXJkcycpKTtcbiAgICBpZiAodGhpcy5jYXJkcyA9PT0gbnVsbCkgdGhpcy5jYXJkcyA9IFtdO1xuXG4gICAgdGhpcy5jbGVhckFycmF5KCk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcbiAgY2xlYXJBcnJheTogZnVuY3Rpb24gKCkge1xuICAgIGxldCBpO1xuXG4gICAgdGhpcy5jYXJkcyA9IHRoaXMuY2FyZHMuZmlsdGVyKGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICByZXR1cm4gZWxlbSAhPT0gdW5kZWZpbmVkICYmIGVsZW0gIT09IG51bGw7XG4gICAgfSk7XG4gICAgZm9yIChpIGluIHRoaXMuY2FyZHMpIHtcbiAgICAgIGlmICh0aGlzLmNhcmRzLmhhc093blByb3BlcnR5KGkpKSB7XG4gICAgICAgIHRoaXMuY2FyZHNbaV0uaWQgPSBpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICByZW5kZXJBbGxDYXJkczogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuY2FyZHMuZm9yRWFjaChmdW5jdGlvbiAoY2FyZCkge1xuICAgICAgLy8gY2FyZC5fX3Byb3RvX18gPSBDYXJkLnByb3RvdHlwZTtcbiAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZihjYXJkLCBDYXJkKTtcbiAgICAgIGNhcmQucmVuZGVyKCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcbiAgZ2V0SW5zdGFuY2U6IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoQ2FyZE1hbmFnZXIuaW5zdGFuY2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgQ2FyZE1hbmFnZXIuaW5zdGFuY2UgPSBPYmplY3QuY3JlYXRlKENhcmRNYW5hZ2VyLCB7fSk7XG4gICAgICBwdWJzdWIuc3ViKHdpbmRvdy5DT05GSUcuU0FWRV9DQVJEUywgQ2FyZE1hbmFnZXIuaW5zdGFuY2Uuc2F2ZUNhcmRzLCBDYXJkTWFuYWdlci5pbnN0YW5jZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIENhcmRNYW5hZ2VyLmluc3RhbmNlO1xuXG4gIH0sXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IENhcmRNYW5hZ2VyOyIsImxldCBjYXJkTWFuYWdlciA9IHJlcXVpcmUoJy4vbW9kZWxzL0NhcmRNYW5hZ2VyJykuZ2V0SW5zdGFuY2UoKTtcblxuZnVuY3Rpb24gY3JlYXRlRGl2KHRleHQsIGNsYXNzTmFtZSkge1xuICBsZXQgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIGRpdi5pbm5lckhUTUwgPSB0ZXh0O1xuICBkaXYuc3R5bGUuZmxvYXQgPSBcInJpZ2h0XCI7XG4gIGRpdi5zdHlsZS5jdXJzb3IgPSBcInBvaW50ZXJcIjtcbiAgZGl2LnN0eWxlLndpZHRoID0gXCIxNnB4XCI7XG4gIGRpdi5zdHlsZS50ZXh0QWxpZ24gPSBcImNlbnRlclwiO1xuXG4gIGlmIChjbGFzc05hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgIGRpdi5jbGFzc05hbWUgPSBjbGFzc05hbWU7XG4gIH1cblxuICByZXR1cm4gZGl2O1xufVxuXG5mdW5jdGlvbiBjb3B5U2VsZWN0aW9uVGV4dCgpIHtcbiAgbGV0IGNvcHlzdWNjZXNzOyAvLyBsZXQgdG8gY2hlY2sgd2hldGhlciBleGVjQ29tbWFuZCBzdWNjZXNzZnVsbHkgZXhlY3V0ZWRcbiAgdHJ5IHtcbiAgICBjb3B5c3VjY2VzcyA9IGRvY3VtZW50LmV4ZWNDb21tYW5kKFwiY29weVwiKTsgLy8gcnVuIGNvbW1hbmQgdG8gY29weSBzZWxlY3RlZCB0ZXh0IHRvIGNsaXBib2FyZFxuICB9IGNhdGNoIChlKSB7XG4gICAgY29weXN1Y2Nlc3MgPSBmYWxzZVxuICB9XG4gIHJldHVybiBjb3B5c3VjY2Vzc1xufVxuXG5mdW5jdGlvbiBzZWxlY3RUZXh0KGVsZW1lbnQpIHtcbiAgbGV0IGRvYyA9IGRvY3VtZW50XG4gICAgLCB0ZXh0ID0gZWxlbWVudFxuICAgICwgcmFuZ2UsIHNlbGVjdGlvblxuICAgIDtcbiAgaWYgKGRvYy5ib2R5LmNyZWF0ZVRleHRSYW5nZSkge1xuICAgIHJhbmdlID0gZG9jdW1lbnQuYm9keS5jcmVhdGVUZXh0UmFuZ2UoKTtcbiAgICByYW5nZS5tb3ZlVG9FbGVtZW50VGV4dCh0ZXh0KTtcbiAgICByYW5nZS5zZWxlY3QoKTtcbiAgfSBlbHNlIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKSB7XG4gICAgc2VsZWN0aW9uID0gd2luZG93LmdldFNlbGVjdGlvbigpO1xuICAgIHJhbmdlID0gZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTtcbiAgICByYW5nZS5zZWxlY3ROb2RlQ29udGVudHModGV4dCk7XG4gICAgc2VsZWN0aW9uLnJlbW92ZUFsbFJhbmdlcygpO1xuICAgIHNlbGVjdGlvbi5hZGRSYW5nZShyYW5nZSk7XG4gICAgcmV0dXJuIHNlbGVjdGlvbjtcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXRQYXJlbnRDYXJkSWQoY29udGV4dCkge1xuICBpZiAoY29udGV4dC5wYXJlbnRFbGVtZW50ID09PSBudWxsKSByZXR1cm47XG4gIHJldHVybiBwYXJzZUludChjb250ZXh0LnBhcmVudEVsZW1lbnQuaWQuc3BsaXQoXCJfXCIpWzFdKTtcbn1cblxuZnVuY3Rpb24gY2hhbmdlRGVwdGgoY2FyZElkLCBpbmNyZW1lbnQpIHtcbiAgbGV0IGRlcHRoID0gcGFyc2VJbnQodGhpcy5wYXJlbnRFbGVtZW50LnN0eWxlLnpJbmRleCkgKyBpbmNyZW1lbnQ7XG5cbiAgdGhpcy5wYXJlbnRFbGVtZW50LnN0eWxlLnpJbmRleCA9IGRlcHRoO1xuICBjYXJkTWFuYWdlci5jYXJkc1tjYXJkSWRdLmRlcHRoID0gZGVwdGg7XG4gIHRoaXMucGFyZW50RWxlbWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiZGVwdGhcIilbMF0uaW5uZXJIVE1MID0gZGVwdGg7XG59XG5cbi8vIFBST1RPVFlQRVNcblxuLypcbiAqIFJldHVybnMgdGhlIHNpemUgb2YgYW4gYXJyYXlcbiAqL1xuQXJyYXkucHJvdG90eXBlLnNpemUgPSBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiB0aGlzLmZpbHRlcihmdW5jdGlvbiAoYSkge1xuICAgIHJldHVybiBhICE9PSB1bmRlZmluZWQ7XG4gIH0pLmxlbmd0aFxufTtcblxuLypcbiAqIFJldHVybnMgdGhlIHNpemUgb2YgYW4gb2JqZWN0XG4gKi9cbk9iamVjdC5zaXplID0gZnVuY3Rpb24gKG9iaikge1xuICBsZXQgc2l6ZSA9IDAsIGtleSA9IFwiXCI7XG5cbiAgZm9yIChrZXkgaW4gb2JqKSB7XG4gICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShrZXkpKSBzaXplKys7XG4gIH1cbiAgcmV0dXJuIHNpemU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgY3JlYXRlRGl2OiBjcmVhdGVEaXYsXG4gIGNvcHlTZWxlY3Rpb25UZXh0OiBjb3B5U2VsZWN0aW9uVGV4dCxcbiAgc2VsZWN0VGV4dDogc2VsZWN0VGV4dCxcbiAgZ2V0UGFyZW50Q2FyZElkOiBnZXRQYXJlbnRDYXJkSWQsXG4gIGNoYW5nZURlcHRoOiBjaGFuZ2VEZXB0aFxufSJdfQ=="}