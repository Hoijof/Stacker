{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","src/js/config.js","src/js/lib/pubsub.js","src/js/main.js","src/js/models/Card.js","src/js/models/CardManager.js","src/js/prototypes.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","module.exports = {\n  SAVE_CARDS: 'SAVE_CARDS'\n}","\nvar subs = {};\n\n\nfunction pub(name, params) {\n  subs[name].forEach(function(elem) {\n    elem.callback.apply(elem.context, params);\n  });\n}\n\nfunction sub(name, callback, context) {\n  if (subs[name] === undefined) {\n    subs[name] = [];\n  }\n\n  subs[name].push({\n    callback: callback,\n    context: context\n  });\n}\n\n\nmodule.exports = {\n  pub: pub,\n  sub: sub\n}","window.CONFIG = require('./config.js')\n\nvar prototypes  = require('./prototypes'),\n    Card        = require('./models/Card'),\n    CardManager = require('./models/CardManager');\n\n\nvar cardManager = CardManager.getInstance();\n\nObject.assign(window, require('./prototypes'));\n\n\ndocument.addEventListener('DOMContentLoaded', function () {\n  \"strict mode\";\n\n  var mainContainer = $(\"#mainContainer\"),\n      input         = document.querySelector(\"#formContainer input\"),\n      editContainer = document.getElementById('editContainer'),\n      editInput     = editContainer.getElementsByClassName('input')[0];\n\n  input.addEventListener('keyup', function (event) {\n    event.stopPropagation();\n    var card,\n        TABKEY = 9;\n\n    if (event.keyCode === 13) {\n      card = cardManager.addCard(new Card(input.value));\n      card.render();\n      this.value = \"\";\n      cardManager.saveCards();\n    }\n  });\n\n  window.addEventListener('keydown', keyHandler, false);\n\n  function keyHandler(e) {\n    var TABKEY = 9;\n    if(e.keyCode === TABKEY) {\n      if (event.shiftKey) {\n        console.log(\"MoveToPreviousCard\");\n      } else {\n        console.log(\"MoveToNextCard\");\n      }\n      if(e.preventDefault) {\n        e.preventDefault();\n      }\n      return false;\n    }\n  }\n\n  editInput.addEventListener('keyup', function (event) {\n    event.stopPropagation();\n    var card;\n    if (event.keyCode === 13) {\n      card = cardManager.cards[editContainer.cardId];\n      card.name = editInput.value;\n      card.derender();\n      card.render();\n      this.value = \"\";\n      cardManager.saveCards();\n\n      editContainer.style.display = 'none';\n    }\n  });\n\n  /*\n   On double click edit the card\n   */\n  mainContainer.on(\"dblclick\", \"div\", function () {\n    var elem = this.querySelector('.cardText'),\n        cardId,\n        card;\n\n    if (this.id === \"\") {\n      cardId = parseInt(this.parentElement.id.split(\"_\")[1]);\n    } else {\n      cardId = parseInt(this.id.split(\"_\")[1]);\n    }\n\n    card = cardManager.cards[cardId];\n\n    editInput.value = card.name;\n    editContainer.cardId = cardId;\n    editContainer.style.display = 'block';\n    editInput.focus();\n  });\n\n  /*\n   On click perform the card\n   */\n  mainContainer.on(\"click\", \"div\", function (event) {\n    var elem   = this.querySelector('.cardText'),\n        cardId = parseInt(this.id.split(\"_\")[1]),\n        card   = cardManager.cards[cardId];\n\n    if (event.ctrlKey) {\n    }\n    if (event.altKey) {\n      this.querySelector('.copy').click();\n    }\n    if (event.shiftKey) {\n\n    }\n  });\n\n  mainContainer.on(\"click\", \"div > div\", function () {\n    var option = $(this).html(),\n        selection,\n        cardId = getParentCardId(this);\n\n    switch (option) {\n      case '+':\n        changeDepth.apply(this, [cardId, 1]);\n        break;\n      case '-':\n        changeDepth.apply(this, [cardId, -1]);\n        break;\n      case 'C':\n        selection = selectText(this.parentElement.getElementsByClassName('cardText')[0]);\n        copySelectionText();\n        selection.empty();\n        break;\n      case 'x':\n        cardManager.removeCard(cardId, -1);\n        break;\n    }\n    cardManager.saveCards();\n  });\n\n  cardManager.loadCards();\n  cardManager.renderAllCards();\n  input.focus();\n});","var pubsub = require('../lib/pubsub');\n\nfunction Card(name) {\n  this.id = -1;\n  this.name = name;\n  this.depth = 5;\n  this.x = 100;\n  this.y = 100;\n  this.color = '#' + Math.floor(Math.random() * 16777215).toString(16);\n}\n\nCard.prototype.render = function () {\n  var node = document.createElement('div'),\n      text = document.createElement('div'),\n      that = this;\n\n  text.innerHTML = this.name;\n  text.className = \"cardText\";\n\n  node.id = \"todo_\" + this.id;\n  node.className = \"card card-1\";\n  node.style.position = \"fixed\";\n  node.style.left = this.x;\n  node.style.top = this.y;\n  node.style.cursor = \"-webkit-grab\";\n  node.style.zIndex = this.depth;\n\n  document.getElementById(\"mainContainer\").appendChild(node);\n\n  node.appendChild(createDiv('x', \"control remove\"));\n  node.appendChild(createDiv('+', \"control up\"));\n  node.appendChild(createDiv('-', \"control down\"));\n  node.appendChild(createDiv('C', \"control copy\"));\n  node.appendChild(createDiv(this.depth, \"depth\"));\n\n  node.appendChild(text);\n\n  $(\"#todo_\" + this.id).draggable({\n    stop: function () {\n      var card = $(\"#todo_\" + that.id);\n      that.x = card.css(\"left\");\n      that.y = card.css(\"top\");\n\n      // cardManager.saveCards();\n      pubsub.pub(window.CONFIG.SAVE_CARDS);\n    }\n  });\n};\n\nCard.prototype.derender = function () {\n  var node = document.getElementById(\"todo_\" + this.id);\n  document.getElementById(\"mainContainer\").removeChild(node);\n};\n\nmodule.exports = Card;","var Card = require('./Card'),\n  pubsub = require('../lib/pubsub');\n\n\nfunction CardManager() {\n  this.cards = [];\n}\n\nCardManager.prototype.addCard = function (card) {\n  this.cards.push(card);\n  card.id = this.cards.length - 1;\n\n  return card;\n};\n\nCardManager.prototype.removeCard = function (id) {\n  this.cards[id].derender();\n  this.cards[id] = undefined;\n};\n\nCardManager.prototype.redrawCard = function (cardId, x, y) {\n  var card = this.cards[cardId];\n  card.x = x;\n  card.y = y;\n\n  card.derender();\n  card.render();\n};\n\nCardManager.prototype.saveCards = function () {\n  if (typeof(Storage) !== \"undefined\") {\n    localStorage.setItem(\"cards\", JSON.stringify(this.cards));\n  } else {\n    console.log(\"you don't have local storage :(\");\n  }\n};\n\nCardManager.prototype.loadCards = function () {\n  var i;\n\n  this.cards = JSON.parse(localStorage.getItem(\"cards\"));\n  if (this.cards === null) this.cards = [];\n\n  this.clearArray();\n};\n\nCardManager.prototype.clearArray = function () {\n  var i;\n\n  this.cards = this.cards.filter(function (elem) {\n    return elem !== undefined && elem !== null\n  });\n  for (i in this.cards) {\n    if (this.cards.hasOwnProperty(i)) {\n      this.cards[i].id = i;\n    }\n  }\n};\n\nCardManager.prototype.renderAllCards = function () {\n  this.cards.forEach(function (card) {\n    // card.__proto__ = Card.prototype;\n    Object.setPrototypeOf(card, Card.prototype);\n    card.render();\n  })\n};\n\nCardManager.getInstance = function() {\n  if (CardManager.instance === undefined) {\n    CardManager.instance = new CardManager();\n    pubsub.sub(window.CONFIG.SAVE_CARDS, CardManager.instance.saveCards, CardManager.instance);\n  }\n\n  return CardManager.instance;\n}\n\nmodule.exports = CardManager;","var cardManager = require('./models/CardManager').getInstance();\n\nfunction createDiv(text, className) {\n  var div = document.createElement('div');\n  div.innerHTML = text;\n  div.style.float = \"right\";\n  div.style.cursor = \"pointer\";\n  div.style.width = \"16px\";\n  div.style.textAlign = \"center\";\n\n  if (className !== undefined) {\n    div.className = className;\n  }\n\n  return div;\n}\n\nfunction copySelectionText() {\n  var copysuccess; // var to check whether execCommand successfully executed\n  try {\n    copysuccess = document.execCommand(\"copy\"); // run command to copy selected text to clipboard\n  } catch (e) {\n    copysuccess = false\n  }\n  return copysuccess\n}\n\nfunction selectText(element) {\n  var doc = document\n    , text = element\n    , range, selection\n    ;\n  if (doc.body.createTextRange) {\n    range = document.body.createTextRange();\n    range.moveToElementText(text);\n    range.select();\n  } else if (window.getSelection) {\n    selection = window.getSelection();\n    range = document.createRange();\n    range.selectNodeContents(text);\n    selection.removeAllRanges();\n    selection.addRange(range);\n    return selection;\n  }\n}\n\nfunction getParentCardId(context) {\n  if (context.parentElement === null) return;\n  return parseInt(context.parentElement.id.split(\"_\")[1]);\n}\n\nfunction changeDepth(cardId, increment) {\n  var depth = parseInt(this.parentElement.style.zIndex) + increment;\n\n  this.parentElement.style.zIndex = depth;\n  cardManager.cards[cardId].depth = depth;\n  this.parentElement.getElementsByClassName(\"depth\")[0].innerHTML = depth;\n}\n\n// PROTOTYPES\n\n/*\n * Returns the size of an array\n */\nArray.prototype.size = function () {\n  return this.filter(function (a) {\n    return a !== undefined;\n  }).length\n};\n\n/*\n * Returns the size of an object\n */\nObject.size = function (obj) {\n  var size = 0, key = \"\";\n\n  for (key in obj) {\n    if (obj.hasOwnProperty(key)) size++;\n  }\n  return size;\n};\n\nmodule.exports = {\n  createDiv: createDiv,\n  copySelectionText: copySelectionText,\n  selectText: selectText,\n  getParentCardId: getParentCardId,\n  changeDepth: changeDepth\n}"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvY29uZmlnLmpzIiwic3JjL2pzL2xpYi9wdWJzdWIuanMiLCJzcmMvanMvbWFpbi5qcyIsInNyYy9qcy9tb2RlbHMvQ2FyZC5qcyIsInNyYy9qcy9tb2RlbHMvQ2FyZE1hbmFnZXIuanMiLCJzcmMvanMvcHJvdG90eXBlcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTs7QUNGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwibW9kdWxlLmV4cG9ydHMgPSB7XG4gIFNBVkVfQ0FSRFM6ICdTQVZFX0NBUkRTJ1xufSIsIlxudmFyIHN1YnMgPSB7fTtcblxuXG5mdW5jdGlvbiBwdWIobmFtZSwgcGFyYW1zKSB7XG4gIHN1YnNbbmFtZV0uZm9yRWFjaChmdW5jdGlvbihlbGVtKSB7XG4gICAgZWxlbS5jYWxsYmFjay5hcHBseShlbGVtLmNvbnRleHQsIHBhcmFtcyk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBzdWIobmFtZSwgY2FsbGJhY2ssIGNvbnRleHQpIHtcbiAgaWYgKHN1YnNbbmFtZV0gPT09IHVuZGVmaW5lZCkge1xuICAgIHN1YnNbbmFtZV0gPSBbXTtcbiAgfVxuXG4gIHN1YnNbbmFtZV0ucHVzaCh7XG4gICAgY2FsbGJhY2s6IGNhbGxiYWNrLFxuICAgIGNvbnRleHQ6IGNvbnRleHRcbiAgfSk7XG59XG5cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIHB1YjogcHViLFxuICBzdWI6IHN1YlxufSIsIndpbmRvdy5DT05GSUcgPSByZXF1aXJlKCcuL2NvbmZpZy5qcycpXG5cbnZhciBwcm90b3R5cGVzICA9IHJlcXVpcmUoJy4vcHJvdG90eXBlcycpLFxuICAgIENhcmQgICAgICAgID0gcmVxdWlyZSgnLi9tb2RlbHMvQ2FyZCcpLFxuICAgIENhcmRNYW5hZ2VyID0gcmVxdWlyZSgnLi9tb2RlbHMvQ2FyZE1hbmFnZXInKTtcblxuXG52YXIgY2FyZE1hbmFnZXIgPSBDYXJkTWFuYWdlci5nZXRJbnN0YW5jZSgpO1xuXG5PYmplY3QuYXNzaWduKHdpbmRvdywgcmVxdWlyZSgnLi9wcm90b3R5cGVzJykpO1xuXG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbiAoKSB7XG4gIFwic3RyaWN0IG1vZGVcIjtcblxuICB2YXIgbWFpbkNvbnRhaW5lciA9ICQoXCIjbWFpbkNvbnRhaW5lclwiKSxcbiAgICAgIGlucHV0ICAgICAgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2Zvcm1Db250YWluZXIgaW5wdXRcIiksXG4gICAgICBlZGl0Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRDb250YWluZXInKSxcbiAgICAgIGVkaXRJbnB1dCAgICAgPSBlZGl0Q29udGFpbmVyLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2lucHV0JylbMF07XG5cbiAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB2YXIgY2FyZCxcbiAgICAgICAgVEFCS0VZID0gOTtcblxuICAgIGlmIChldmVudC5rZXlDb2RlID09PSAxMykge1xuICAgICAgY2FyZCA9IGNhcmRNYW5hZ2VyLmFkZENhcmQobmV3IENhcmQoaW5wdXQudmFsdWUpKTtcbiAgICAgIGNhcmQucmVuZGVyKCk7XG4gICAgICB0aGlzLnZhbHVlID0gXCJcIjtcbiAgICAgIGNhcmRNYW5hZ2VyLnNhdmVDYXJkcygpO1xuICAgIH1cbiAgfSk7XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBrZXlIYW5kbGVyLCBmYWxzZSk7XG5cbiAgZnVuY3Rpb24ga2V5SGFuZGxlcihlKSB7XG4gICAgdmFyIFRBQktFWSA9IDk7XG4gICAgaWYoZS5rZXlDb2RlID09PSBUQUJLRVkpIHtcbiAgICAgIGlmIChldmVudC5zaGlmdEtleSkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIk1vdmVUb1ByZXZpb3VzQ2FyZFwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiTW92ZVRvTmV4dENhcmRcIik7XG4gICAgICB9XG4gICAgICBpZihlLnByZXZlbnREZWZhdWx0KSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBlZGl0SW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB2YXIgY2FyZDtcbiAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMpIHtcbiAgICAgIGNhcmQgPSBjYXJkTWFuYWdlci5jYXJkc1tlZGl0Q29udGFpbmVyLmNhcmRJZF07XG4gICAgICBjYXJkLm5hbWUgPSBlZGl0SW5wdXQudmFsdWU7XG4gICAgICBjYXJkLmRlcmVuZGVyKCk7XG4gICAgICBjYXJkLnJlbmRlcigpO1xuICAgICAgdGhpcy52YWx1ZSA9IFwiXCI7XG4gICAgICBjYXJkTWFuYWdlci5zYXZlQ2FyZHMoKTtcblxuICAgICAgZWRpdENvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgIH1cbiAgfSk7XG5cbiAgLypcbiAgIE9uIGRvdWJsZSBjbGljayBlZGl0IHRoZSBjYXJkXG4gICAqL1xuICBtYWluQ29udGFpbmVyLm9uKFwiZGJsY2xpY2tcIiwgXCJkaXZcIiwgZnVuY3Rpb24gKCkge1xuICAgIHZhciBlbGVtID0gdGhpcy5xdWVyeVNlbGVjdG9yKCcuY2FyZFRleHQnKSxcbiAgICAgICAgY2FyZElkLFxuICAgICAgICBjYXJkO1xuXG4gICAgaWYgKHRoaXMuaWQgPT09IFwiXCIpIHtcbiAgICAgIGNhcmRJZCA9IHBhcnNlSW50KHRoaXMucGFyZW50RWxlbWVudC5pZC5zcGxpdChcIl9cIilbMV0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBjYXJkSWQgPSBwYXJzZUludCh0aGlzLmlkLnNwbGl0KFwiX1wiKVsxXSk7XG4gICAgfVxuXG4gICAgY2FyZCA9IGNhcmRNYW5hZ2VyLmNhcmRzW2NhcmRJZF07XG5cbiAgICBlZGl0SW5wdXQudmFsdWUgPSBjYXJkLm5hbWU7XG4gICAgZWRpdENvbnRhaW5lci5jYXJkSWQgPSBjYXJkSWQ7XG4gICAgZWRpdENvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICBlZGl0SW5wdXQuZm9jdXMoKTtcbiAgfSk7XG5cbiAgLypcbiAgIE9uIGNsaWNrIHBlcmZvcm0gdGhlIGNhcmRcbiAgICovXG4gIG1haW5Db250YWluZXIub24oXCJjbGlja1wiLCBcImRpdlwiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB2YXIgZWxlbSAgID0gdGhpcy5xdWVyeVNlbGVjdG9yKCcuY2FyZFRleHQnKSxcbiAgICAgICAgY2FyZElkID0gcGFyc2VJbnQodGhpcy5pZC5zcGxpdChcIl9cIilbMV0pLFxuICAgICAgICBjYXJkICAgPSBjYXJkTWFuYWdlci5jYXJkc1tjYXJkSWRdO1xuXG4gICAgaWYgKGV2ZW50LmN0cmxLZXkpIHtcbiAgICB9XG4gICAgaWYgKGV2ZW50LmFsdEtleSkge1xuICAgICAgdGhpcy5xdWVyeVNlbGVjdG9yKCcuY29weScpLmNsaWNrKCk7XG4gICAgfVxuICAgIGlmIChldmVudC5zaGlmdEtleSkge1xuXG4gICAgfVxuICB9KTtcblxuICBtYWluQ29udGFpbmVyLm9uKFwiY2xpY2tcIiwgXCJkaXYgPiBkaXZcIiwgZnVuY3Rpb24gKCkge1xuICAgIHZhciBvcHRpb24gPSAkKHRoaXMpLmh0bWwoKSxcbiAgICAgICAgc2VsZWN0aW9uLFxuICAgICAgICBjYXJkSWQgPSBnZXRQYXJlbnRDYXJkSWQodGhpcyk7XG5cbiAgICBzd2l0Y2ggKG9wdGlvbikge1xuICAgICAgY2FzZSAnKyc6XG4gICAgICAgIGNoYW5nZURlcHRoLmFwcGx5KHRoaXMsIFtjYXJkSWQsIDFdKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICctJzpcbiAgICAgICAgY2hhbmdlRGVwdGguYXBwbHkodGhpcywgW2NhcmRJZCwgLTFdKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdDJzpcbiAgICAgICAgc2VsZWN0aW9uID0gc2VsZWN0VGV4dCh0aGlzLnBhcmVudEVsZW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnY2FyZFRleHQnKVswXSk7XG4gICAgICAgIGNvcHlTZWxlY3Rpb25UZXh0KCk7XG4gICAgICAgIHNlbGVjdGlvbi5lbXB0eSgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3gnOlxuICAgICAgICBjYXJkTWFuYWdlci5yZW1vdmVDYXJkKGNhcmRJZCwgLTEpO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgY2FyZE1hbmFnZXIuc2F2ZUNhcmRzKCk7XG4gIH0pO1xuXG4gIGNhcmRNYW5hZ2VyLmxvYWRDYXJkcygpO1xuICBjYXJkTWFuYWdlci5yZW5kZXJBbGxDYXJkcygpO1xuICBpbnB1dC5mb2N1cygpO1xufSk7IiwidmFyIHB1YnN1YiA9IHJlcXVpcmUoJy4uL2xpYi9wdWJzdWInKTtcblxuZnVuY3Rpb24gQ2FyZChuYW1lKSB7XG4gIHRoaXMuaWQgPSAtMTtcbiAgdGhpcy5uYW1lID0gbmFtZTtcbiAgdGhpcy5kZXB0aCA9IDU7XG4gIHRoaXMueCA9IDEwMDtcbiAgdGhpcy55ID0gMTAwO1xuICB0aGlzLmNvbG9yID0gJyMnICsgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTY3NzcyMTUpLnRvU3RyaW5nKDE2KTtcbn1cblxuQ2FyZC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICB2YXIgbm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLFxuICAgICAgdGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLFxuICAgICAgdGhhdCA9IHRoaXM7XG5cbiAgdGV4dC5pbm5lckhUTUwgPSB0aGlzLm5hbWU7XG4gIHRleHQuY2xhc3NOYW1lID0gXCJjYXJkVGV4dFwiO1xuXG4gIG5vZGUuaWQgPSBcInRvZG9fXCIgKyB0aGlzLmlkO1xuICBub2RlLmNsYXNzTmFtZSA9IFwiY2FyZCBjYXJkLTFcIjtcbiAgbm9kZS5zdHlsZS5wb3NpdGlvbiA9IFwiZml4ZWRcIjtcbiAgbm9kZS5zdHlsZS5sZWZ0ID0gdGhpcy54O1xuICBub2RlLnN0eWxlLnRvcCA9IHRoaXMueTtcbiAgbm9kZS5zdHlsZS5jdXJzb3IgPSBcIi13ZWJraXQtZ3JhYlwiO1xuICBub2RlLnN0eWxlLnpJbmRleCA9IHRoaXMuZGVwdGg7XG5cbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtYWluQ29udGFpbmVyXCIpLmFwcGVuZENoaWxkKG5vZGUpO1xuXG4gIG5vZGUuYXBwZW5kQ2hpbGQoY3JlYXRlRGl2KCd4JywgXCJjb250cm9sIHJlbW92ZVwiKSk7XG4gIG5vZGUuYXBwZW5kQ2hpbGQoY3JlYXRlRGl2KCcrJywgXCJjb250cm9sIHVwXCIpKTtcbiAgbm9kZS5hcHBlbmRDaGlsZChjcmVhdGVEaXYoJy0nLCBcImNvbnRyb2wgZG93blwiKSk7XG4gIG5vZGUuYXBwZW5kQ2hpbGQoY3JlYXRlRGl2KCdDJywgXCJjb250cm9sIGNvcHlcIikpO1xuICBub2RlLmFwcGVuZENoaWxkKGNyZWF0ZURpdih0aGlzLmRlcHRoLCBcImRlcHRoXCIpKTtcblxuICBub2RlLmFwcGVuZENoaWxkKHRleHQpO1xuXG4gICQoXCIjdG9kb19cIiArIHRoaXMuaWQpLmRyYWdnYWJsZSh7XG4gICAgc3RvcDogZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGNhcmQgPSAkKFwiI3RvZG9fXCIgKyB0aGF0LmlkKTtcbiAgICAgIHRoYXQueCA9IGNhcmQuY3NzKFwibGVmdFwiKTtcbiAgICAgIHRoYXQueSA9IGNhcmQuY3NzKFwidG9wXCIpO1xuXG4gICAgICAvLyBjYXJkTWFuYWdlci5zYXZlQ2FyZHMoKTtcbiAgICAgIHB1YnN1Yi5wdWIod2luZG93LkNPTkZJRy5TQVZFX0NBUkRTKTtcbiAgICB9XG4gIH0pO1xufTtcblxuQ2FyZC5wcm90b3R5cGUuZGVyZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBub2RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0b2RvX1wiICsgdGhpcy5pZCk7XG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWFpbkNvbnRhaW5lclwiKS5yZW1vdmVDaGlsZChub2RlKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQ2FyZDsiLCJ2YXIgQ2FyZCA9IHJlcXVpcmUoJy4vQ2FyZCcpLFxuICBwdWJzdWIgPSByZXF1aXJlKCcuLi9saWIvcHVic3ViJyk7XG5cblxuZnVuY3Rpb24gQ2FyZE1hbmFnZXIoKSB7XG4gIHRoaXMuY2FyZHMgPSBbXTtcbn1cblxuQ2FyZE1hbmFnZXIucHJvdG90eXBlLmFkZENhcmQgPSBmdW5jdGlvbiAoY2FyZCkge1xuICB0aGlzLmNhcmRzLnB1c2goY2FyZCk7XG4gIGNhcmQuaWQgPSB0aGlzLmNhcmRzLmxlbmd0aCAtIDE7XG5cbiAgcmV0dXJuIGNhcmQ7XG59O1xuXG5DYXJkTWFuYWdlci5wcm90b3R5cGUucmVtb3ZlQ2FyZCA9IGZ1bmN0aW9uIChpZCkge1xuICB0aGlzLmNhcmRzW2lkXS5kZXJlbmRlcigpO1xuICB0aGlzLmNhcmRzW2lkXSA9IHVuZGVmaW5lZDtcbn07XG5cbkNhcmRNYW5hZ2VyLnByb3RvdHlwZS5yZWRyYXdDYXJkID0gZnVuY3Rpb24gKGNhcmRJZCwgeCwgeSkge1xuICB2YXIgY2FyZCA9IHRoaXMuY2FyZHNbY2FyZElkXTtcbiAgY2FyZC54ID0geDtcbiAgY2FyZC55ID0geTtcblxuICBjYXJkLmRlcmVuZGVyKCk7XG4gIGNhcmQucmVuZGVyKCk7XG59O1xuXG5DYXJkTWFuYWdlci5wcm90b3R5cGUuc2F2ZUNhcmRzID0gZnVuY3Rpb24gKCkge1xuICBpZiAodHlwZW9mKFN0b3JhZ2UpICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJjYXJkc1wiLCBKU09OLnN0cmluZ2lmeSh0aGlzLmNhcmRzKSk7XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS5sb2coXCJ5b3UgZG9uJ3QgaGF2ZSBsb2NhbCBzdG9yYWdlIDooXCIpO1xuICB9XG59O1xuXG5DYXJkTWFuYWdlci5wcm90b3R5cGUubG9hZENhcmRzID0gZnVuY3Rpb24gKCkge1xuICB2YXIgaTtcblxuICB0aGlzLmNhcmRzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImNhcmRzXCIpKTtcbiAgaWYgKHRoaXMuY2FyZHMgPT09IG51bGwpIHRoaXMuY2FyZHMgPSBbXTtcblxuICB0aGlzLmNsZWFyQXJyYXkoKTtcbn07XG5cbkNhcmRNYW5hZ2VyLnByb3RvdHlwZS5jbGVhckFycmF5ID0gZnVuY3Rpb24gKCkge1xuICB2YXIgaTtcblxuICB0aGlzLmNhcmRzID0gdGhpcy5jYXJkcy5maWx0ZXIoZnVuY3Rpb24gKGVsZW0pIHtcbiAgICByZXR1cm4gZWxlbSAhPT0gdW5kZWZpbmVkICYmIGVsZW0gIT09IG51bGxcbiAgfSk7XG4gIGZvciAoaSBpbiB0aGlzLmNhcmRzKSB7XG4gICAgaWYgKHRoaXMuY2FyZHMuaGFzT3duUHJvcGVydHkoaSkpIHtcbiAgICAgIHRoaXMuY2FyZHNbaV0uaWQgPSBpO1xuICAgIH1cbiAgfVxufTtcblxuQ2FyZE1hbmFnZXIucHJvdG90eXBlLnJlbmRlckFsbENhcmRzID0gZnVuY3Rpb24gKCkge1xuICB0aGlzLmNhcmRzLmZvckVhY2goZnVuY3Rpb24gKGNhcmQpIHtcbiAgICAvLyBjYXJkLl9fcHJvdG9fXyA9IENhcmQucHJvdG90eXBlO1xuICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZihjYXJkLCBDYXJkLnByb3RvdHlwZSk7XG4gICAgY2FyZC5yZW5kZXIoKTtcbiAgfSlcbn07XG5cbkNhcmRNYW5hZ2VyLmdldEluc3RhbmNlID0gZnVuY3Rpb24oKSB7XG4gIGlmIChDYXJkTWFuYWdlci5pbnN0YW5jZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgQ2FyZE1hbmFnZXIuaW5zdGFuY2UgPSBuZXcgQ2FyZE1hbmFnZXIoKTtcbiAgICBwdWJzdWIuc3ViKHdpbmRvdy5DT05GSUcuU0FWRV9DQVJEUywgQ2FyZE1hbmFnZXIuaW5zdGFuY2Uuc2F2ZUNhcmRzLCBDYXJkTWFuYWdlci5pbnN0YW5jZSk7XG4gIH1cblxuICByZXR1cm4gQ2FyZE1hbmFnZXIuaW5zdGFuY2U7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gQ2FyZE1hbmFnZXI7IiwidmFyIGNhcmRNYW5hZ2VyID0gcmVxdWlyZSgnLi9tb2RlbHMvQ2FyZE1hbmFnZXInKS5nZXRJbnN0YW5jZSgpO1xuXG5mdW5jdGlvbiBjcmVhdGVEaXYodGV4dCwgY2xhc3NOYW1lKSB7XG4gIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgZGl2LmlubmVySFRNTCA9IHRleHQ7XG4gIGRpdi5zdHlsZS5mbG9hdCA9IFwicmlnaHRcIjtcbiAgZGl2LnN0eWxlLmN1cnNvciA9IFwicG9pbnRlclwiO1xuICBkaXYuc3R5bGUud2lkdGggPSBcIjE2cHhcIjtcbiAgZGl2LnN0eWxlLnRleHRBbGlnbiA9IFwiY2VudGVyXCI7XG5cbiAgaWYgKGNsYXNzTmFtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgZGl2LmNsYXNzTmFtZSA9IGNsYXNzTmFtZTtcbiAgfVxuXG4gIHJldHVybiBkaXY7XG59XG5cbmZ1bmN0aW9uIGNvcHlTZWxlY3Rpb25UZXh0KCkge1xuICB2YXIgY29weXN1Y2Nlc3M7IC8vIHZhciB0byBjaGVjayB3aGV0aGVyIGV4ZWNDb21tYW5kIHN1Y2Nlc3NmdWxseSBleGVjdXRlZFxuICB0cnkge1xuICAgIGNvcHlzdWNjZXNzID0gZG9jdW1lbnQuZXhlY0NvbW1hbmQoXCJjb3B5XCIpOyAvLyBydW4gY29tbWFuZCB0byBjb3B5IHNlbGVjdGVkIHRleHQgdG8gY2xpcGJvYXJkXG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb3B5c3VjY2VzcyA9IGZhbHNlXG4gIH1cbiAgcmV0dXJuIGNvcHlzdWNjZXNzXG59XG5cbmZ1bmN0aW9uIHNlbGVjdFRleHQoZWxlbWVudCkge1xuICB2YXIgZG9jID0gZG9jdW1lbnRcbiAgICAsIHRleHQgPSBlbGVtZW50XG4gICAgLCByYW5nZSwgc2VsZWN0aW9uXG4gICAgO1xuICBpZiAoZG9jLmJvZHkuY3JlYXRlVGV4dFJhbmdlKSB7XG4gICAgcmFuZ2UgPSBkb2N1bWVudC5ib2R5LmNyZWF0ZVRleHRSYW5nZSgpO1xuICAgIHJhbmdlLm1vdmVUb0VsZW1lbnRUZXh0KHRleHQpO1xuICAgIHJhbmdlLnNlbGVjdCgpO1xuICB9IGVsc2UgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24pIHtcbiAgICBzZWxlY3Rpb24gPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7XG4gICAgcmFuZ2UgPSBkb2N1bWVudC5jcmVhdGVSYW5nZSgpO1xuICAgIHJhbmdlLnNlbGVjdE5vZGVDb250ZW50cyh0ZXh0KTtcbiAgICBzZWxlY3Rpb24ucmVtb3ZlQWxsUmFuZ2VzKCk7XG4gICAgc2VsZWN0aW9uLmFkZFJhbmdlKHJhbmdlKTtcbiAgICByZXR1cm4gc2VsZWN0aW9uO1xuICB9XG59XG5cbmZ1bmN0aW9uIGdldFBhcmVudENhcmRJZChjb250ZXh0KSB7XG4gIGlmIChjb250ZXh0LnBhcmVudEVsZW1lbnQgPT09IG51bGwpIHJldHVybjtcbiAgcmV0dXJuIHBhcnNlSW50KGNvbnRleHQucGFyZW50RWxlbWVudC5pZC5zcGxpdChcIl9cIilbMV0pO1xufVxuXG5mdW5jdGlvbiBjaGFuZ2VEZXB0aChjYXJkSWQsIGluY3JlbWVudCkge1xuICB2YXIgZGVwdGggPSBwYXJzZUludCh0aGlzLnBhcmVudEVsZW1lbnQuc3R5bGUuekluZGV4KSArIGluY3JlbWVudDtcblxuICB0aGlzLnBhcmVudEVsZW1lbnQuc3R5bGUuekluZGV4ID0gZGVwdGg7XG4gIGNhcmRNYW5hZ2VyLmNhcmRzW2NhcmRJZF0uZGVwdGggPSBkZXB0aDtcbiAgdGhpcy5wYXJlbnRFbGVtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJkZXB0aFwiKVswXS5pbm5lckhUTUwgPSBkZXB0aDtcbn1cblxuLy8gUFJPVE9UWVBFU1xuXG4vKlxuICogUmV0dXJucyB0aGUgc2l6ZSBvZiBhbiBhcnJheVxuICovXG5BcnJheS5wcm90b3R5cGUuc2l6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIHRoaXMuZmlsdGVyKGZ1bmN0aW9uIChhKSB7XG4gICAgcmV0dXJuIGEgIT09IHVuZGVmaW5lZDtcbiAgfSkubGVuZ3RoXG59O1xuXG4vKlxuICogUmV0dXJucyB0aGUgc2l6ZSBvZiBhbiBvYmplY3RcbiAqL1xuT2JqZWN0LnNpemUgPSBmdW5jdGlvbiAob2JqKSB7XG4gIHZhciBzaXplID0gMCwga2V5ID0gXCJcIjtcblxuICBmb3IgKGtleSBpbiBvYmopIHtcbiAgICBpZiAob2JqLmhhc093blByb3BlcnR5KGtleSkpIHNpemUrKztcbiAgfVxuICByZXR1cm4gc2l6ZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBjcmVhdGVEaXY6IGNyZWF0ZURpdixcbiAgY29weVNlbGVjdGlvblRleHQ6IGNvcHlTZWxlY3Rpb25UZXh0LFxuICBzZWxlY3RUZXh0OiBzZWxlY3RUZXh0LFxuICBnZXRQYXJlbnRDYXJkSWQ6IGdldFBhcmVudENhcmRJZCxcbiAgY2hhbmdlRGVwdGg6IGNoYW5nZURlcHRoXG59Il19"}