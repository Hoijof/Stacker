{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","src/js/config.js","src/js/lib/pubsub.js","src/js/main.js","src/js/models/Card.js","src/js/models/CardManager.js","src/js/prototypes.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","module.exports = {\n  SAVE_CARDS: 'SAVE_CARDS'\n}","\nvar subs = {};\n\n\nfunction pub(name, params) {\n  subs[name].forEach(function(elem) {\n    elem.callback.apply(elem.context, params);\n  });\n}\n\nfunction sub(name, callback, context) {\n  if (subs[name] === undefined) {\n    subs[name] = [];\n  }\n\n  subs[name].push({\n    callback: callback,\n    context: context\n  });\n}\n\n\nmodule.exports = {\n  pub: pub,\n  sub: sub\n}","window.CONFIG = require('./config.js')\n\nlet prototypes  = require('./prototypes'),\n    Card        = require('./models/Card'),\n    CardManager = require('./models/CardManager');\n\n\nlet cardManager = CardManager.getInstance();\n\nObject.assign(window, require('./prototypes'));\n\n\ndocument.addEventListener('DOMContentLoaded', function () {\n  \"strict mode\";\n\n  let mainContainer = $(\"#mainContainer\"),\n      input         = document.querySelector(\"#formContainer input\"),\n      editContainer = document.getElementById('editContainer'),\n      editInput     = editContainer.getElementsByClassName('input')[0];\n\n  input.addEventListener('keyup', function (event) {\n    event.stopPropagation();\n    let card,\n        TABKEY = 9;\n\n    if (event.keyCode === 13) {\n      card = cardManager.addCard(Object.create(Card, {}).init(input.value));\n      card.render();\n      this.value = \"\";\n      cardManager.saveCards();\n    }\n  });\n\n  window.addEventListener('keydown', keyHandler, false);\n\n  function keyHandler(e) {\n    let TABKEY = 9;\n    if(e.keyCode === TABKEY) {\n      if (event.shiftKey) {\n        console.log(\"MoveToPreviousCard\");\n      } else {\n        console.log(\"MoveToNextCard\");\n      }\n      if(e.preventDefault) {\n        e.preventDefault();\n      }\n      return false;\n    }\n  }\n\n  editInput.addEventListener('keyup', function (event) {\n    event.stopPropagation();\n    let card;\n    if (event.keyCode === 13) {\n      card = cardManager.cards[editContainer.cardId];\n      card.name = editInput.value;\n      card.derender();\n      card.render();\n      this.value = \"\";\n      cardManager.saveCards();\n\n      editContainer.style.display = 'none';\n    }\n  });\n\n  /*\n   On double click edit the card\n   */\n  mainContainer.on(\"dblclick\", \"div\", function () {\n    let elem = this.querySelector('.cardText'),\n        cardId,\n        card;\n\n    if (this.id === \"\") {\n      cardId = parseInt(this.parentElement.id.split(\"_\")[1]);\n    } else {\n      cardId = parseInt(this.id.split(\"_\")[1]);\n    }\n\n    card = cardManager.cards[cardId];\n\n    editInput.value = card.name;\n    editContainer.cardId = cardId;\n    editContainer.style.display = 'block';\n    editInput.focus();\n  });\n\n  /*\n   On click perform the card\n   */\n  mainContainer.on(\"click\", \"div\", function (event) {\n    let elem   = this.querySelector('.cardText'),\n        cardId = parseInt(this.id.split(\"_\")[1]),\n        card   = cardManager.cards[cardId];\n\n    if (event.ctrlKey) {\n    }\n    if (event.altKey) {\n      this.querySelector('.copy').click();\n    }\n    if (event.shiftKey) {\n\n    }\n  });\n\n  mainContainer.on(\"click\", \"div > div\", function () {\n    let option = $(this).html(),\n        selection,\n        cardId = getParentCardId(this);\n\n    switch (option) {\n      case '+':\n        changeDepth.apply(this, [cardId, 1]);\n        break;\n      case '-':\n        changeDepth.apply(this, [cardId, -1]);\n        break;\n      case 'C':\n        selection = selectText(this.parentElement.getElementsByClassName('cardText')[0]);\n        copySelectionText();\n        selection.empty();\n        break;\n      case 'x':\n        cardManager.removeCard(cardId, -1);\n        break;\n    }\n    cardManager.saveCards();\n  });\n\n  cardManager.loadCards();\n  cardManager.renderAllCards();\n  input.focus();\n});","let pubsub = require('../lib/pubsub');\n\nlet Card = {\n      init: function (name) {\n        this.id = -1;\n        this.name = name;\n        this.depth = 5;\n        this.x = 100;\n        this.y = 100;\n        this.color = '#' + Math.floor(Math.random() * 16777215).toString(16);\n\n        return this;\n      },\n      render: function () {\n        let node = document.createElement('div'),\n            text = document.createElement('div'),\n            that = this;\n\n        text.innerHTML = this.name;\n        text.className = \"cardText\";\n\n        node.id = \"todo_\" + this.id;\n        node.className = \"card card-1\";\n        node.style.position = \"fixed\";\n        node.style.left = this.x;\n        node.style.top = this.y;\n        node.style.cursor = \"-webkit-grab\";\n        node.style.zIndex = this.depth;\n\n        document.getElementById(\"mainContainer\").appendChild(node);\n\n        node.appendChild(createDiv('x', \"control remove\"));\n        node.appendChild(createDiv('+', \"control up\"));\n        node.appendChild(createDiv('-', \"control down\"));\n        node.appendChild(createDiv('C', \"control copy\"));\n        node.appendChild(createDiv(this.depth, \"depth\"));\n\n        node.appendChild(text);\n\n        $(\"#todo_\" + this.id).draggable({\n          stop: function () {\n            let card = $(\"#todo_\" + that.id);\n            that.x = card.css(\"left\");\n            that.y = card.css(\"top\");\n\n            // cardManager.saveCards();\n            pubsub.pub(window.CONFIG.SAVE_CARDS);\n          }\n        });\n      },\n      derender: function () {\n        let node = document.getElementById(\"todo_\" + this.id);\n        document.getElementById(\"mainContainer\").removeChild(node);\n      }\n    }\n\nmodule.exports = Card;","const Card = require('./Card'),\n  pubsub = require('../lib/pubsub');\n\nlet CardManager = {\n  init: function () {\n    this.cards = [];\n\n    return this;\n  },\n  addCard: function (card) {\n    this.cards.push(card);\n    card.id = this.cards.length - 1;\n\n    return card;\n  },\n  removeCard: function (id) {\n    this.cards[id].derender();\n    this.cards[id] = undefined;\n\n    return this;\n  },\n  redrawCard: function (cardId, x, y) {\n    let card = this.cards[cardId];\n    card.x = x;\n    card.y = y;\n\n    card.derender();\n    card.render();\n\n    return this;\n  },\n  saveCards: function () {\n    if (typeof(Storage) !== \"undefined\") {\n      localStorage.setItem(\"cards\", JSON.stringify(this.cards));\n    } else {\n      console.log(\"you don't have local storage :(\");\n    }\n\n    return this;\n  },\n  loadCards: function () {\n    let i;\n\n    this.cards = JSON.parse(localStorage.getItem(\"cards\"));\n    if (this.cards === null) this.cards = [];\n\n    this.clearArray();\n\n    return this;\n  },\n  clearArray: function () {\n    let i;\n\n    this.cards = this.cards.filter(function (elem) {\n      return elem !== undefined && elem !== null\n    });\n    for (i in this.cards) {\n      if (this.cards.hasOwnProperty(i)) {\n        this.cards[i].id = i;\n      }\n    }\n\n    return this;\n  },\n  renderAllCards: function () {\n    this.cards.forEach(function (card) {\n      // card.__proto__ = Card.prototype;\n      Object.setPrototypeOf(card, Card);\n      card.render();\n    })\n\n    return this;\n  },\n  getInstance: function () {\n    if (CardManager.instance === undefined) {\n      CardManager.instance = Object.create(CardManager, {});\n      pubsub.sub(window.CONFIG.SAVE_CARDS, CardManager.instance.saveCards, CardManager.instance);\n    }\n\n    return CardManager.instance;\n\n  }\n}\n\nmodule.exports = CardManager;","var cardManager = require('./models/CardManager').getInstance();\n\nfunction createDiv(text, className) {\n  var div = document.createElement('div');\n  div.innerHTML = text;\n  div.style.float = \"right\";\n  div.style.cursor = \"pointer\";\n  div.style.width = \"16px\";\n  div.style.textAlign = \"center\";\n\n  if (className !== undefined) {\n    div.className = className;\n  }\n\n  return div;\n}\n\nfunction copySelectionText() {\n  var copysuccess; // var to check whether execCommand successfully executed\n  try {\n    copysuccess = document.execCommand(\"copy\"); // run command to copy selected text to clipboard\n  } catch (e) {\n    copysuccess = false\n  }\n  return copysuccess\n}\n\nfunction selectText(element) {\n  var doc = document\n    , text = element\n    , range, selection\n    ;\n  if (doc.body.createTextRange) {\n    range = document.body.createTextRange();\n    range.moveToElementText(text);\n    range.select();\n  } else if (window.getSelection) {\n    selection = window.getSelection();\n    range = document.createRange();\n    range.selectNodeContents(text);\n    selection.removeAllRanges();\n    selection.addRange(range);\n    return selection;\n  }\n}\n\nfunction getParentCardId(context) {\n  if (context.parentElement === null) return;\n  return parseInt(context.parentElement.id.split(\"_\")[1]);\n}\n\nfunction changeDepth(cardId, increment) {\n  var depth = parseInt(this.parentElement.style.zIndex) + increment;\n\n  this.parentElement.style.zIndex = depth;\n  cardManager.cards[cardId].depth = depth;\n  this.parentElement.getElementsByClassName(\"depth\")[0].innerHTML = depth;\n}\n\n// PROTOTYPES\n\n/*\n * Returns the size of an array\n */\nArray.prototype.size = function () {\n  return this.filter(function (a) {\n    return a !== undefined;\n  }).length\n};\n\n/*\n * Returns the size of an object\n */\nObject.size = function (obj) {\n  var size = 0, key = \"\";\n\n  for (key in obj) {\n    if (obj.hasOwnProperty(key)) size++;\n  }\n  return size;\n};\n\nmodule.exports = {\n  createDiv: createDiv,\n  copySelectionText: copySelectionText,\n  selectText: selectText,\n  getParentCardId: getParentCardId,\n  changeDepth: changeDepth\n}"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvY29uZmlnLmpzIiwic3JjL2pzL2xpYi9wdWJzdWIuanMiLCJzcmMvanMvbWFpbi5qcyIsInNyYy9qcy9tb2RlbHMvQ2FyZC5qcyIsInNyYy9qcy9tb2RlbHMvQ2FyZE1hbmFnZXIuanMiLCJzcmMvanMvcHJvdG90eXBlcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTs7QUNGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJtb2R1bGUuZXhwb3J0cyA9IHtcbiAgU0FWRV9DQVJEUzogJ1NBVkVfQ0FSRFMnXG59IiwiXG52YXIgc3VicyA9IHt9O1xuXG5cbmZ1bmN0aW9uIHB1YihuYW1lLCBwYXJhbXMpIHtcbiAgc3Vic1tuYW1lXS5mb3JFYWNoKGZ1bmN0aW9uKGVsZW0pIHtcbiAgICBlbGVtLmNhbGxiYWNrLmFwcGx5KGVsZW0uY29udGV4dCwgcGFyYW1zKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHN1YihuYW1lLCBjYWxsYmFjaywgY29udGV4dCkge1xuICBpZiAoc3Vic1tuYW1lXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgc3Vic1tuYW1lXSA9IFtdO1xuICB9XG5cbiAgc3Vic1tuYW1lXS5wdXNoKHtcbiAgICBjYWxsYmFjazogY2FsbGJhY2ssXG4gICAgY29udGV4dDogY29udGV4dFxuICB9KTtcbn1cblxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgcHViOiBwdWIsXG4gIHN1Yjogc3ViXG59Iiwid2luZG93LkNPTkZJRyA9IHJlcXVpcmUoJy4vY29uZmlnLmpzJylcblxubGV0IHByb3RvdHlwZXMgID0gcmVxdWlyZSgnLi9wcm90b3R5cGVzJyksXG4gICAgQ2FyZCAgICAgICAgPSByZXF1aXJlKCcuL21vZGVscy9DYXJkJyksXG4gICAgQ2FyZE1hbmFnZXIgPSByZXF1aXJlKCcuL21vZGVscy9DYXJkTWFuYWdlcicpO1xuXG5cbmxldCBjYXJkTWFuYWdlciA9IENhcmRNYW5hZ2VyLmdldEluc3RhbmNlKCk7XG5cbk9iamVjdC5hc3NpZ24od2luZG93LCByZXF1aXJlKCcuL3Byb3RvdHlwZXMnKSk7XG5cblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uICgpIHtcbiAgXCJzdHJpY3QgbW9kZVwiO1xuXG4gIGxldCBtYWluQ29udGFpbmVyID0gJChcIiNtYWluQ29udGFpbmVyXCIpLFxuICAgICAgaW5wdXQgICAgICAgICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZm9ybUNvbnRhaW5lciBpbnB1dFwiKSxcbiAgICAgIGVkaXRDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdENvbnRhaW5lcicpLFxuICAgICAgZWRpdElucHV0ICAgICA9IGVkaXRDb250YWluZXIuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnaW5wdXQnKVswXTtcblxuICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIGxldCBjYXJkLFxuICAgICAgICBUQUJLRVkgPSA5O1xuXG4gICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzKSB7XG4gICAgICBjYXJkID0gY2FyZE1hbmFnZXIuYWRkQ2FyZChPYmplY3QuY3JlYXRlKENhcmQsIHt9KS5pbml0KGlucHV0LnZhbHVlKSk7XG4gICAgICBjYXJkLnJlbmRlcigpO1xuICAgICAgdGhpcy52YWx1ZSA9IFwiXCI7XG4gICAgICBjYXJkTWFuYWdlci5zYXZlQ2FyZHMoKTtcbiAgICB9XG4gIH0pO1xuXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywga2V5SGFuZGxlciwgZmFsc2UpO1xuXG4gIGZ1bmN0aW9uIGtleUhhbmRsZXIoZSkge1xuICAgIGxldCBUQUJLRVkgPSA5O1xuICAgIGlmKGUua2V5Q29kZSA9PT0gVEFCS0VZKSB7XG4gICAgICBpZiAoZXZlbnQuc2hpZnRLZXkpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJNb3ZlVG9QcmV2aW91c0NhcmRcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZyhcIk1vdmVUb05leHRDYXJkXCIpO1xuICAgICAgfVxuICAgICAgaWYoZS5wcmV2ZW50RGVmYXVsdCkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgZWRpdElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgbGV0IGNhcmQ7XG4gICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzKSB7XG4gICAgICBjYXJkID0gY2FyZE1hbmFnZXIuY2FyZHNbZWRpdENvbnRhaW5lci5jYXJkSWRdO1xuICAgICAgY2FyZC5uYW1lID0gZWRpdElucHV0LnZhbHVlO1xuICAgICAgY2FyZC5kZXJlbmRlcigpO1xuICAgICAgY2FyZC5yZW5kZXIoKTtcbiAgICAgIHRoaXMudmFsdWUgPSBcIlwiO1xuICAgICAgY2FyZE1hbmFnZXIuc2F2ZUNhcmRzKCk7XG5cbiAgICAgIGVkaXRDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICB9XG4gIH0pO1xuXG4gIC8qXG4gICBPbiBkb3VibGUgY2xpY2sgZWRpdCB0aGUgY2FyZFxuICAgKi9cbiAgbWFpbkNvbnRhaW5lci5vbihcImRibGNsaWNrXCIsIFwiZGl2XCIsIGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgZWxlbSA9IHRoaXMucXVlcnlTZWxlY3RvcignLmNhcmRUZXh0JyksXG4gICAgICAgIGNhcmRJZCxcbiAgICAgICAgY2FyZDtcblxuICAgIGlmICh0aGlzLmlkID09PSBcIlwiKSB7XG4gICAgICBjYXJkSWQgPSBwYXJzZUludCh0aGlzLnBhcmVudEVsZW1lbnQuaWQuc3BsaXQoXCJfXCIpWzFdKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2FyZElkID0gcGFyc2VJbnQodGhpcy5pZC5zcGxpdChcIl9cIilbMV0pO1xuICAgIH1cblxuICAgIGNhcmQgPSBjYXJkTWFuYWdlci5jYXJkc1tjYXJkSWRdO1xuXG4gICAgZWRpdElucHV0LnZhbHVlID0gY2FyZC5uYW1lO1xuICAgIGVkaXRDb250YWluZXIuY2FyZElkID0gY2FyZElkO1xuICAgIGVkaXRDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgZWRpdElucHV0LmZvY3VzKCk7XG4gIH0pO1xuXG4gIC8qXG4gICBPbiBjbGljayBwZXJmb3JtIHRoZSBjYXJkXG4gICAqL1xuICBtYWluQ29udGFpbmVyLm9uKFwiY2xpY2tcIiwgXCJkaXZcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgbGV0IGVsZW0gICA9IHRoaXMucXVlcnlTZWxlY3RvcignLmNhcmRUZXh0JyksXG4gICAgICAgIGNhcmRJZCA9IHBhcnNlSW50KHRoaXMuaWQuc3BsaXQoXCJfXCIpWzFdKSxcbiAgICAgICAgY2FyZCAgID0gY2FyZE1hbmFnZXIuY2FyZHNbY2FyZElkXTtcblxuICAgIGlmIChldmVudC5jdHJsS2V5KSB7XG4gICAgfVxuICAgIGlmIChldmVudC5hbHRLZXkpIHtcbiAgICAgIHRoaXMucXVlcnlTZWxlY3RvcignLmNvcHknKS5jbGljaygpO1xuICAgIH1cbiAgICBpZiAoZXZlbnQuc2hpZnRLZXkpIHtcblxuICAgIH1cbiAgfSk7XG5cbiAgbWFpbkNvbnRhaW5lci5vbihcImNsaWNrXCIsIFwiZGl2ID4gZGl2XCIsIGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgb3B0aW9uID0gJCh0aGlzKS5odG1sKCksXG4gICAgICAgIHNlbGVjdGlvbixcbiAgICAgICAgY2FyZElkID0gZ2V0UGFyZW50Q2FyZElkKHRoaXMpO1xuXG4gICAgc3dpdGNoIChvcHRpb24pIHtcbiAgICAgIGNhc2UgJysnOlxuICAgICAgICBjaGFuZ2VEZXB0aC5hcHBseSh0aGlzLCBbY2FyZElkLCAxXSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnLSc6XG4gICAgICAgIGNoYW5nZURlcHRoLmFwcGx5KHRoaXMsIFtjYXJkSWQsIC0xXSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnQyc6XG4gICAgICAgIHNlbGVjdGlvbiA9IHNlbGVjdFRleHQodGhpcy5wYXJlbnRFbGVtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2NhcmRUZXh0JylbMF0pO1xuICAgICAgICBjb3B5U2VsZWN0aW9uVGV4dCgpO1xuICAgICAgICBzZWxlY3Rpb24uZW1wdHkoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICd4JzpcbiAgICAgICAgY2FyZE1hbmFnZXIucmVtb3ZlQ2FyZChjYXJkSWQsIC0xKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNhcmRNYW5hZ2VyLnNhdmVDYXJkcygpO1xuICB9KTtcblxuICBjYXJkTWFuYWdlci5sb2FkQ2FyZHMoKTtcbiAgY2FyZE1hbmFnZXIucmVuZGVyQWxsQ2FyZHMoKTtcbiAgaW5wdXQuZm9jdXMoKTtcbn0pOyIsImxldCBwdWJzdWIgPSByZXF1aXJlKCcuLi9saWIvcHVic3ViJyk7XG5cbmxldCBDYXJkID0ge1xuICAgICAgaW5pdDogZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdGhpcy5pZCA9IC0xO1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLmRlcHRoID0gNTtcbiAgICAgICAgdGhpcy54ID0gMTAwO1xuICAgICAgICB0aGlzLnkgPSAxMDA7XG4gICAgICAgIHRoaXMuY29sb3IgPSAnIycgKyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxNjc3NzIxNSkudG9TdHJpbmcoMTYpO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfSxcbiAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICBsZXQgbm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLFxuICAgICAgICAgICAgdGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLFxuICAgICAgICAgICAgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgdGV4dC5pbm5lckhUTUwgPSB0aGlzLm5hbWU7XG4gICAgICAgIHRleHQuY2xhc3NOYW1lID0gXCJjYXJkVGV4dFwiO1xuXG4gICAgICAgIG5vZGUuaWQgPSBcInRvZG9fXCIgKyB0aGlzLmlkO1xuICAgICAgICBub2RlLmNsYXNzTmFtZSA9IFwiY2FyZCBjYXJkLTFcIjtcbiAgICAgICAgbm9kZS5zdHlsZS5wb3NpdGlvbiA9IFwiZml4ZWRcIjtcbiAgICAgICAgbm9kZS5zdHlsZS5sZWZ0ID0gdGhpcy54O1xuICAgICAgICBub2RlLnN0eWxlLnRvcCA9IHRoaXMueTtcbiAgICAgICAgbm9kZS5zdHlsZS5jdXJzb3IgPSBcIi13ZWJraXQtZ3JhYlwiO1xuICAgICAgICBub2RlLnN0eWxlLnpJbmRleCA9IHRoaXMuZGVwdGg7XG5cbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtYWluQ29udGFpbmVyXCIpLmFwcGVuZENoaWxkKG5vZGUpO1xuXG4gICAgICAgIG5vZGUuYXBwZW5kQ2hpbGQoY3JlYXRlRGl2KCd4JywgXCJjb250cm9sIHJlbW92ZVwiKSk7XG4gICAgICAgIG5vZGUuYXBwZW5kQ2hpbGQoY3JlYXRlRGl2KCcrJywgXCJjb250cm9sIHVwXCIpKTtcbiAgICAgICAgbm9kZS5hcHBlbmRDaGlsZChjcmVhdGVEaXYoJy0nLCBcImNvbnRyb2wgZG93blwiKSk7XG4gICAgICAgIG5vZGUuYXBwZW5kQ2hpbGQoY3JlYXRlRGl2KCdDJywgXCJjb250cm9sIGNvcHlcIikpO1xuICAgICAgICBub2RlLmFwcGVuZENoaWxkKGNyZWF0ZURpdih0aGlzLmRlcHRoLCBcImRlcHRoXCIpKTtcblxuICAgICAgICBub2RlLmFwcGVuZENoaWxkKHRleHQpO1xuXG4gICAgICAgICQoXCIjdG9kb19cIiArIHRoaXMuaWQpLmRyYWdnYWJsZSh7XG4gICAgICAgICAgc3RvcDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbGV0IGNhcmQgPSAkKFwiI3RvZG9fXCIgKyB0aGF0LmlkKTtcbiAgICAgICAgICAgIHRoYXQueCA9IGNhcmQuY3NzKFwibGVmdFwiKTtcbiAgICAgICAgICAgIHRoYXQueSA9IGNhcmQuY3NzKFwidG9wXCIpO1xuXG4gICAgICAgICAgICAvLyBjYXJkTWFuYWdlci5zYXZlQ2FyZHMoKTtcbiAgICAgICAgICAgIHB1YnN1Yi5wdWIod2luZG93LkNPTkZJRy5TQVZFX0NBUkRTKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIGRlcmVuZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxldCBub2RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0b2RvX1wiICsgdGhpcy5pZCk7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWFpbkNvbnRhaW5lclwiKS5yZW1vdmVDaGlsZChub2RlKTtcbiAgICAgIH1cbiAgICB9XG5cbm1vZHVsZS5leHBvcnRzID0gQ2FyZDsiLCJjb25zdCBDYXJkID0gcmVxdWlyZSgnLi9DYXJkJyksXG4gIHB1YnN1YiA9IHJlcXVpcmUoJy4uL2xpYi9wdWJzdWInKTtcblxubGV0IENhcmRNYW5hZ2VyID0ge1xuICBpbml0OiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5jYXJkcyA9IFtdO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIGFkZENhcmQ6IGZ1bmN0aW9uIChjYXJkKSB7XG4gICAgdGhpcy5jYXJkcy5wdXNoKGNhcmQpO1xuICAgIGNhcmQuaWQgPSB0aGlzLmNhcmRzLmxlbmd0aCAtIDE7XG5cbiAgICByZXR1cm4gY2FyZDtcbiAgfSxcbiAgcmVtb3ZlQ2FyZDogZnVuY3Rpb24gKGlkKSB7XG4gICAgdGhpcy5jYXJkc1tpZF0uZGVyZW5kZXIoKTtcbiAgICB0aGlzLmNhcmRzW2lkXSA9IHVuZGVmaW5lZDtcblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICByZWRyYXdDYXJkOiBmdW5jdGlvbiAoY2FyZElkLCB4LCB5KSB7XG4gICAgbGV0IGNhcmQgPSB0aGlzLmNhcmRzW2NhcmRJZF07XG4gICAgY2FyZC54ID0geDtcbiAgICBjYXJkLnkgPSB5O1xuXG4gICAgY2FyZC5kZXJlbmRlcigpO1xuICAgIGNhcmQucmVuZGVyKCk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcbiAgc2F2ZUNhcmRzOiBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHR5cGVvZihTdG9yYWdlKSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJjYXJkc1wiLCBKU09OLnN0cmluZ2lmeSh0aGlzLmNhcmRzKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKFwieW91IGRvbid0IGhhdmUgbG9jYWwgc3RvcmFnZSA6KFwiKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcbiAgbG9hZENhcmRzOiBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IGk7XG5cbiAgICB0aGlzLmNhcmRzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImNhcmRzXCIpKTtcbiAgICBpZiAodGhpcy5jYXJkcyA9PT0gbnVsbCkgdGhpcy5jYXJkcyA9IFtdO1xuXG4gICAgdGhpcy5jbGVhckFycmF5KCk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcbiAgY2xlYXJBcnJheTogZnVuY3Rpb24gKCkge1xuICAgIGxldCBpO1xuXG4gICAgdGhpcy5jYXJkcyA9IHRoaXMuY2FyZHMuZmlsdGVyKGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICByZXR1cm4gZWxlbSAhPT0gdW5kZWZpbmVkICYmIGVsZW0gIT09IG51bGxcbiAgICB9KTtcbiAgICBmb3IgKGkgaW4gdGhpcy5jYXJkcykge1xuICAgICAgaWYgKHRoaXMuY2FyZHMuaGFzT3duUHJvcGVydHkoaSkpIHtcbiAgICAgICAgdGhpcy5jYXJkc1tpXS5pZCA9IGk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIHJlbmRlckFsbENhcmRzOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5jYXJkcy5mb3JFYWNoKGZ1bmN0aW9uIChjYXJkKSB7XG4gICAgICAvLyBjYXJkLl9fcHJvdG9fXyA9IENhcmQucHJvdG90eXBlO1xuICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKGNhcmQsIENhcmQpO1xuICAgICAgY2FyZC5yZW5kZXIoKTtcbiAgICB9KVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIGdldEluc3RhbmNlOiBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKENhcmRNYW5hZ2VyLmluc3RhbmNlID09PSB1bmRlZmluZWQpIHtcbiAgICAgIENhcmRNYW5hZ2VyLmluc3RhbmNlID0gT2JqZWN0LmNyZWF0ZShDYXJkTWFuYWdlciwge30pO1xuICAgICAgcHVic3ViLnN1Yih3aW5kb3cuQ09ORklHLlNBVkVfQ0FSRFMsIENhcmRNYW5hZ2VyLmluc3RhbmNlLnNhdmVDYXJkcywgQ2FyZE1hbmFnZXIuaW5zdGFuY2UpO1xuICAgIH1cblxuICAgIHJldHVybiBDYXJkTWFuYWdlci5pbnN0YW5jZTtcblxuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gQ2FyZE1hbmFnZXI7IiwidmFyIGNhcmRNYW5hZ2VyID0gcmVxdWlyZSgnLi9tb2RlbHMvQ2FyZE1hbmFnZXInKS5nZXRJbnN0YW5jZSgpO1xuXG5mdW5jdGlvbiBjcmVhdGVEaXYodGV4dCwgY2xhc3NOYW1lKSB7XG4gIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgZGl2LmlubmVySFRNTCA9IHRleHQ7XG4gIGRpdi5zdHlsZS5mbG9hdCA9IFwicmlnaHRcIjtcbiAgZGl2LnN0eWxlLmN1cnNvciA9IFwicG9pbnRlclwiO1xuICBkaXYuc3R5bGUud2lkdGggPSBcIjE2cHhcIjtcbiAgZGl2LnN0eWxlLnRleHRBbGlnbiA9IFwiY2VudGVyXCI7XG5cbiAgaWYgKGNsYXNzTmFtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgZGl2LmNsYXNzTmFtZSA9IGNsYXNzTmFtZTtcbiAgfVxuXG4gIHJldHVybiBkaXY7XG59XG5cbmZ1bmN0aW9uIGNvcHlTZWxlY3Rpb25UZXh0KCkge1xuICB2YXIgY29weXN1Y2Nlc3M7IC8vIHZhciB0byBjaGVjayB3aGV0aGVyIGV4ZWNDb21tYW5kIHN1Y2Nlc3NmdWxseSBleGVjdXRlZFxuICB0cnkge1xuICAgIGNvcHlzdWNjZXNzID0gZG9jdW1lbnQuZXhlY0NvbW1hbmQoXCJjb3B5XCIpOyAvLyBydW4gY29tbWFuZCB0byBjb3B5IHNlbGVjdGVkIHRleHQgdG8gY2xpcGJvYXJkXG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb3B5c3VjY2VzcyA9IGZhbHNlXG4gIH1cbiAgcmV0dXJuIGNvcHlzdWNjZXNzXG59XG5cbmZ1bmN0aW9uIHNlbGVjdFRleHQoZWxlbWVudCkge1xuICB2YXIgZG9jID0gZG9jdW1lbnRcbiAgICAsIHRleHQgPSBlbGVtZW50XG4gICAgLCByYW5nZSwgc2VsZWN0aW9uXG4gICAgO1xuICBpZiAoZG9jLmJvZHkuY3JlYXRlVGV4dFJhbmdlKSB7XG4gICAgcmFuZ2UgPSBkb2N1bWVudC5ib2R5LmNyZWF0ZVRleHRSYW5nZSgpO1xuICAgIHJhbmdlLm1vdmVUb0VsZW1lbnRUZXh0KHRleHQpO1xuICAgIHJhbmdlLnNlbGVjdCgpO1xuICB9IGVsc2UgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24pIHtcbiAgICBzZWxlY3Rpb24gPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7XG4gICAgcmFuZ2UgPSBkb2N1bWVudC5jcmVhdGVSYW5nZSgpO1xuICAgIHJhbmdlLnNlbGVjdE5vZGVDb250ZW50cyh0ZXh0KTtcbiAgICBzZWxlY3Rpb24ucmVtb3ZlQWxsUmFuZ2VzKCk7XG4gICAgc2VsZWN0aW9uLmFkZFJhbmdlKHJhbmdlKTtcbiAgICByZXR1cm4gc2VsZWN0aW9uO1xuICB9XG59XG5cbmZ1bmN0aW9uIGdldFBhcmVudENhcmRJZChjb250ZXh0KSB7XG4gIGlmIChjb250ZXh0LnBhcmVudEVsZW1lbnQgPT09IG51bGwpIHJldHVybjtcbiAgcmV0dXJuIHBhcnNlSW50KGNvbnRleHQucGFyZW50RWxlbWVudC5pZC5zcGxpdChcIl9cIilbMV0pO1xufVxuXG5mdW5jdGlvbiBjaGFuZ2VEZXB0aChjYXJkSWQsIGluY3JlbWVudCkge1xuICB2YXIgZGVwdGggPSBwYXJzZUludCh0aGlzLnBhcmVudEVsZW1lbnQuc3R5bGUuekluZGV4KSArIGluY3JlbWVudDtcblxuICB0aGlzLnBhcmVudEVsZW1lbnQuc3R5bGUuekluZGV4ID0gZGVwdGg7XG4gIGNhcmRNYW5hZ2VyLmNhcmRzW2NhcmRJZF0uZGVwdGggPSBkZXB0aDtcbiAgdGhpcy5wYXJlbnRFbGVtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJkZXB0aFwiKVswXS5pbm5lckhUTUwgPSBkZXB0aDtcbn1cblxuLy8gUFJPVE9UWVBFU1xuXG4vKlxuICogUmV0dXJucyB0aGUgc2l6ZSBvZiBhbiBhcnJheVxuICovXG5BcnJheS5wcm90b3R5cGUuc2l6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIHRoaXMuZmlsdGVyKGZ1bmN0aW9uIChhKSB7XG4gICAgcmV0dXJuIGEgIT09IHVuZGVmaW5lZDtcbiAgfSkubGVuZ3RoXG59O1xuXG4vKlxuICogUmV0dXJucyB0aGUgc2l6ZSBvZiBhbiBvYmplY3RcbiAqL1xuT2JqZWN0LnNpemUgPSBmdW5jdGlvbiAob2JqKSB7XG4gIHZhciBzaXplID0gMCwga2V5ID0gXCJcIjtcblxuICBmb3IgKGtleSBpbiBvYmopIHtcbiAgICBpZiAob2JqLmhhc093blByb3BlcnR5KGtleSkpIHNpemUrKztcbiAgfVxuICByZXR1cm4gc2l6ZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBjcmVhdGVEaXY6IGNyZWF0ZURpdixcbiAgY29weVNlbGVjdGlvblRleHQ6IGNvcHlTZWxlY3Rpb25UZXh0LFxuICBzZWxlY3RUZXh0OiBzZWxlY3RUZXh0LFxuICBnZXRQYXJlbnRDYXJkSWQ6IGdldFBhcmVudENhcmRJZCxcbiAgY2hhbmdlRGVwdGg6IGNoYW5nZURlcHRoXG59Il19"}